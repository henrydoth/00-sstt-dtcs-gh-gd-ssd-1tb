---
title: "C√°ch qu·∫£n l√Ω citation v√† ki·ªÉm tra citation b·ªã tr√πng l·∫Øp"
author: "YHCT team"
date: today
format:
  html:
    toc: true
    toc-location: right
    code-fold: false       # b·∫≠t n√∫t ·∫©n/hi·ªán m√£ R
    code-summary: "Hi·ªÉn th·ªã/R√∫t g·ªçn m√£ R"  # nh√£n n√∫t (c√≥ th·ªÉ t√πy ch·ªânh)
editor: source
---



# N·∫°p th∆∞ vi·ªán ph√¢n t√≠ch citation

```{r}

if (!require("pacman")) install.packages("pacman") 
pacman::p_load(bib2df, tidyverse, flextable, officer, glue, scales, rvg, forcats, citr)

```

# ƒê·ªçc bib file v√†o dataframe
```{r}
#| echo: true
#| message: false
#| warning: false
#| paged-print: false
tltk <- bib2df("sstt_reference.bib")
```

# M√¥ t·∫£ citation
## M√¥ t·∫£ danh s√°ch citation t·ª´ file BibTeX
```{r}
# Ch·ªçn c√°c tr∆∞·ªùng quan tr·ªçng ƒë·ªÉ m√¥ t·∫£ citation
citation_summary <- tltk %>%
  select(BIBTEXKEY, AUTHOR, TITLE, YEAR, CATEGORY, JOURNAL, PUBLISHER) %>%
  mutate(
    YEAR = as.character(YEAR),
    AUTHOR = str_trunc(AUTHOR, 50),  # c·∫Øt ng·∫Øn t√°c gi·∫£ n·∫øu qu√° d√†i
    TITLE = str_trunc(TITLE, 80)     # c·∫Øt ng·∫Øn ti√™u ƒë·ªÅ n·∫øu qu√° d√†i
  )

# T·∫°o b·∫£ng b·∫±ng flextable
flextable::flextable(citation_summary) %>%
  flextable::set_caption("üìö B·∫£ng m√¥ t·∫£ c√°c m·ª•c tr√≠ch d·∫´n t·ª´ file BibTeX") %>%
  flextable::autofit()
```

## Bi·ªÉu ƒë·ªì s·ªë l∆∞·ª£ng citation theo nƒÉm (YEAR)
```{r}
#| echo: true
#| message: false
#| warning: false
#| paged-print: false
# Chu·∫©n b·ªã d·ªØ li·ªáu
year_summary <- tltk %>%
  filter(!is.na(YEAR)) %>%
  count(YEAR) %>%
  mutate(percent = n / sum(n) * 100)

# V·∫Ω bi·ªÉu ƒë·ªì v·ªõi m√†u ri√™ng cho t·ª´ng nƒÉm
ggplot(year_summary, aes(x = factor(YEAR), y = n, fill = factor(YEAR))) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = glue("{n} ({round(percent,1)}%)")), vjust = -0.5, size = 3.5) +
  labs(
    title = "S·ªë l∆∞·ª£ng citation theo nƒÉm xu·∫•t b·∫£n",
    x = "NƒÉm xu·∫•t b·∫£n",
    y = "S·ªë citation"
  ) +
  theme_minimal()

```
## Bi·ªÉu ƒë·ªì s·ªë l∆∞·ª£ng citation theo lo·∫°i t√†i li·ªáu (CATEGORY)

```{r}
#| echo: true
#| message: false
#| warning: false
#| paged-print: false

category_summary <- tltk %>%
  filter(!is.na(CATEGORY)) %>%
  count(CATEGORY) %>%
  mutate(percent = n / sum(n) * 100)

# V·∫Ω bi·ªÉu ƒë·ªì
ggplot(category_summary, aes(x = fct_reorder(CATEGORY, n), y = n, fill = CATEGORY)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = glue("{n} ({round(percent,1)}%)")), hjust = -0.1, size = 3.5) +
  coord_flip() +
  labs(
    title = "S·ªë l∆∞·ª£ng citation theo lo·∫°i t√†i li·ªáu",
    x = "Lo·∫°i t√†i li·ªáu (BibTeX)",
    y = "S·ªë l∆∞·ª£ng"
  ) +
  theme_minimal()
```



# Ki·ªÉm tra c√°c citation b·ªã tr√πng d·ª±a tr√™n tr∆∞·ªùng "TITLE" (ti√™u ƒë·ªÅ)
```{r}
#| echo: true
duplicated_entries <- tltk %>% 
  filter(duplicated(TITLE))


```
## Hi·ªÉn th·ªã b·∫£ng tr√πng l·∫∑p c√≥ ti√™u ƒë·ªÅ gi·ªëng nhau
```{r}
#| echo: true
flextable::flextable(duplicated_entries)

```



# Ki·ªÉm tra c√°c m·ª•c c√≥ c√πng ti√™u ƒë·ªÅ v√† nƒÉm xu·∫•t b·∫£n
```{r}
#| echo: true
duplicated_title_year <- tltk %>%
  group_by(TITLE, YEAR) %>%
  filter(n() > 1) %>%
  ungroup()

```
##  Hi·ªÉn th·ªã b·∫£ng tr√πng l·∫∑p c√≥ c√πng ti√™u ƒë·ªÅ v√† nƒÉm xu·∫•t b·∫£n

```{r}
#| echo: true
flextable::flextable(duplicated_title_year)
```

# Ki·ªÉm tra tr√πng l·∫∑p theo BIBTEXKEY (m√£ citation)
```{r}
#| echo: true
# Ki·ªÉm tra c√°c bibkey b·ªã tr√πng
duplicated_keys <- tltk %>%
  filter(duplicated(BIBTEXKEY) | duplicated(BIBTEXKEY, fromLast = TRUE))

```

## Hi·ªÉn th·ªã b·∫£ng tr√πng l·∫∑p theo BIBTEXKEY
```{r}
#| echo: true
flextable::flextable(duplicated_keys)
```
