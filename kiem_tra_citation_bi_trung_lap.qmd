---
title: "CÃ¡ch quáº£n lÃ½ citation vÃ  kiá»ƒm tra citation bá»‹ trÃ¹ng láº¯p"
author: "Henry Do"
date: today
format:
  html:
    toc: true
    toc-location: right
    code-fold: true       # báº­t nÃºt áº©n/hiá»‡n mÃ£ R
    code-summary: "Hiá»ƒn thá»‹/RÃºt gá»n mÃ£ R"  # nhÃ£n nÃºt (cÃ³ thá»ƒ tÃ¹y chá»‰nh)
editor: source
---



# Náº¡p thÆ° viá»‡n phÃ¢n tÃ­ch citation

```{r}

if (!require("pacman")) install.packages("pacman") 
pacman::p_load(bib2df, tidyverse, flextable, officer, glue, scales, rvg, forcats, citr)

```

# Äá»c bib file vÃ o dataframe
```{r}
#| echo: true
#| message: false
#| warning: false
#| paged-print: false
tltk <- bib2df("sstt_reference.bib")
```

# MÃ´ táº£ citation
## MÃ´ táº£ danh sÃ¡ch citation tá»« file BibTeX
```{r}
# MÃ´ táº£ cÃ¡c má»¥c trÃ­ch dáº«n tá»« file BibTeX
citation_summary <- tltk %>%
  mutate(
    AUTHOR = map_chr(AUTHOR, ~ str_c(.x, collapse = ", ")),     # GhÃ©p tÃªn tÃ¡c giáº£ thÃ nh chuá»—i
    AUTHOR = str_trunc(AUTHOR, 50),                             # RÃºt gá»n náº¿u quÃ¡ dÃ i
    TITLE = str_trunc(TITLE, 80),                               # RÃºt gá»n tiÃªu Ä‘á» dÃ i
    YEAR = as.character(YEAR)
  ) %>%
  select(BIBTEXKEY, AUTHOR, TITLE, YEAR, CATEGORY, JOURNAL, PUBLISHER)

# ThÃ´ng bÃ¡o sá»‘ lÆ°á»£ng citation
glue("ğŸ“Œ CÃ³ tá»•ng cá»™ng {nrow(citation_summary)} má»¥c trÃ­ch dáº«n trong file BibTeX.")

# Hiá»ƒn thá»‹ báº£ng báº±ng flextable
flextable::flextable(citation_summary) %>%
  flextable::set_caption("ğŸ“š Báº£ng mÃ´ táº£ cÃ¡c má»¥c trÃ­ch dáº«n tá»« file BibTeX") %>%
  flextable::autofit()
```

## Biá»ƒu Ä‘á»“ sá»‘ lÆ°á»£ng citation theo nÄƒm (YEAR)
```{r}
#| echo: true
#| message: false
#| warning: false
#| paged-print: false
# Chuáº©n bá»‹ dá»¯ liá»‡u
year_summary <- tltk %>%
  filter(!is.na(YEAR)) %>%
  count(YEAR) %>%
  mutate(percent = n / sum(n) * 100)

# Váº½ biá»ƒu Ä‘á»“ vá»›i mÃ u riÃªng cho tá»«ng nÄƒm
ggplot(year_summary, aes(x = factor(YEAR), y = n, fill = factor(YEAR))) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = glue("{n} ({round(percent,1)}%)")), vjust = -0.5, size = 3.5) +
  labs(
    title = "Sá»‘ lÆ°á»£ng citation theo nÄƒm xuáº¥t báº£n",
    x = "NÄƒm xuáº¥t báº£n",
    y = "Sá»‘ citation"
  ) +
  theme_minimal()

```
  ## Biá»ƒu Ä‘á»“ sá»‘ lÆ°á»£ng citation theo loáº¡i tÃ i liá»‡u (CATEGORY)

```{r}
#| echo: true
#| message: false
#| warning: false
#| paged-print: false

category_summary <- tltk %>%
  filter(!is.na(CATEGORY)) %>%
  count(CATEGORY) %>%
  mutate(percent = n / sum(n) * 100)

# Váº½ biá»ƒu Ä‘á»“
ggplot(category_summary, aes(x = fct_reorder(CATEGORY, n), y = n, fill = CATEGORY)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = glue("{n} ({round(percent,1)}%)")), hjust = -0.1, size = 3.5) +
  coord_flip() +
  labs(
    title = "Sá»‘ lÆ°á»£ng citation theo loáº¡i tÃ i liá»‡u",
    x = "Loáº¡i tÃ i liá»‡u (BibTeX)",
    y = "Sá»‘ lÆ°á»£ng"
  ) +
  theme_minimal()
```



# Kiá»ƒm tra cÃ¡c citation bá»‹ trÃ¹ng dá»±a trÃªn trÆ°á»ng "TITLE" (tiÃªu Ä‘á»)
```{r}

# Chuáº©n hÃ³a tiÃªu Ä‘á» (viáº¿t thÆ°á»ng + loáº¡i bá» khoáº£ng tráº¯ng thá»«a)
tltk <- tltk %>%
  mutate(title_clean = str_squish(str_to_lower(TITLE)))

# Lá»c cÃ¡c má»¥c trÃ¹ng tiÃªu Ä‘á» (sau chuáº©n hÃ³a)
duplicated_entries <- tltk %>%
  filter(duplicated(title_clean))

# Diá»…n giáº£i sá»‘ má»¥c bá»‹ trÃ¹ng tiÃªu Ä‘á»
glue("ğŸ” PhÃ¡t hiá»‡n {nrow(duplicated_entries)} má»¥c trÃ­ch dáº«n cÃ³ tiÃªu Ä‘á» bá»‹ trÃ¹ng sau khi chuáº©n hÃ³a (bá» khoáº£ng tráº¯ng vÃ  viáº¿t thÆ°á»ng). 
Äiá»u nÃ y cÃ³ thá»ƒ pháº£n Ã¡nh viá»‡c thÃªm láº·p láº¡i cÃ¹ng má»™t tÃ i liá»‡u trong file BibTeX dÆ°á»›i cÃ¡c BIBTEXKEY khÃ¡c nhau.")

# Hiá»ƒn thá»‹ báº£ng: sáº¯p xáº¿p cá»™t theo yÃªu cáº§u
duplicated_entries %>%
  select(BIBTEXKEY, title_clean, YEAR, JOURNAL, DOI, PAGES, everything()) %>%
  flextable::flextable() %>%
  flextable::set_caption("ğŸ“„ CÃ¡c má»¥c trÃ­ch dáº«n bá»‹ trÃ¹ng tiÃªu Ä‘á» (Ä‘Ã£ chuáº©n hÃ³a)") %>%
  flextable::autofit()
```

## Hiá»ƒn thá»‹ ggplot2 trÃ¹ng láº·p

```{r}
# Biá»ƒu Ä‘á»“ cÃ¡c tiÃªu Ä‘á» trÃ­ch dáº«n bá»‹ trÃ¹ng (top 10)

#| echo: true
title_count <- tltk %>%
  count(title_clean, sort = TRUE) %>%
  filter(n > 1)

# Váº½ biá»ƒu Ä‘á»“ top 10 trÃ¹ng láº·p
ggplot(title_count %>% slice_max(n, n = 10), 
       aes(x = reorder(title_clean, n), y = n)) +
  geom_col(fill = "tomato") +
  geom_text(aes(label = n), hjust = -0.2, size = 3.5) +
  coord_flip() +
  labs(
    title = "ğŸ” CÃ¡c tiÃªu Ä‘á» trÃ­ch dáº«n bá»‹ trÃ¹ng (Top 10)",
    x = "TiÃªu Ä‘á» (Ä‘Ã£ chuáº©n hoÃ¡)",
    y = "Sá»‘ láº§n xuáº¥t hiá»‡n"
  ) +
  theme_minimal()
```
## Hiá»ƒn thá»‹ heatmap trÃ¹ng láº·p
```{r}
#| echo: true
# Äáº¿m sá»‘ láº§n má»—i tiÃªu Ä‘á» (Ä‘Ã£ chuáº©n hoÃ¡) xuáº¥t hiá»‡n theo nÄƒm
heat_data <- tltk %>%
  count(title_clean, YEAR) %>%
  filter(n > 1)  # chá»‰ giá»¯ cÃ¡c cáº·p bá»‹ trÃ¹ng

# Váº½ heatmap
ggplot(heat_data, aes(x = factor(YEAR), y = fct_reorder(title_clean, n), fill = n)) +
  geom_tile(color = "white") +
  geom_text(aes(label = n), color = "black", size = 3) +
  scale_fill_gradient(low = "lightyellow", high = "red") +
  labs(
    title = "ğŸ”¥ Heatmap cÃ¡c tiÃªu Ä‘á» trÃ­ch dáº«n bá»‹ trÃ¹ng theo nÄƒm",
    x = "NÄƒm xuáº¥t báº£n",
    y = "TiÃªu Ä‘á» (Ä‘Ã£ chuáº©n hoÃ¡)",
    fill = "Sá»‘ láº§n trÃ¹ng"
  ) +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 8))
```




## BÃ¡o cÃ¡o
```{r}
glue("ğŸ” CÃ³ {nrow(duplicated_entries)} má»¥c trÃ¹ng tiÃªu Ä‘á» (Ä‘Ã£ chuáº©n hÃ³a)")

```



# Kiá»ƒm tra cÃ¡c má»¥c cÃ³ cÃ¹ng tiÃªu Ä‘á» vÃ  nÄƒm xuáº¥t báº£n
```{r}
#| echo: true
duplicated_title_year <- tltk %>%
  group_by(TITLE, YEAR) %>%
  filter(n() > 1) %>%
  ungroup()

```
##  Hiá»ƒn thá»‹ báº£ng trÃ¹ng láº·p cÃ³ cÃ¹ng tiÃªu Ä‘á» vÃ  nÄƒm xuáº¥t báº£n

```{r}
#| echo: true
flextable::flextable(duplicated_title_year)
```

## BÃ¡o cÃ¡o trÃ¹ng láº¯p

```{r}
glue("ğŸ” CÃ³ {nrow(duplicated_title_year)} má»¥c trÃ¹ng tiÃªu Ä‘á» vÃ  nÄƒm xuáº¥t báº£n")

```


# Kiá»ƒm tra trÃ¹ng láº·p theo BIBTEXKEY (mÃ£ citation)
```{r}
#| echo: true
# Kiá»ƒm tra cÃ¡c bibkey bá»‹ trÃ¹ng
duplicated_keys <- tltk %>%
  filter(duplicated(BIBTEXKEY) | duplicated(BIBTEXKEY, fromLast = TRUE))

```

## Hiá»ƒn thá»‹ báº£ng trÃ¹ng láº·p theo BIBTEXKEY
```{r}
#| echo: true
flextable::flextable(duplicated_keys)
```
## BÃ¡o cÃ¡o trÃ¹ng láº·p
```{r}
# Hiá»ƒn thá»‹ sá»‘ lÆ°á»£ng má»¥c trÃ¹ng BIBTEXKEY
glue("âš ï¸ CÃ³ {nrow(duplicated_keys)} má»¥c cÃ³ BIBTEXKEY trÃ¹ng nhau!")

```


# Loáº¡i bá» trÃ¹ng láº·p
## Loáº¡i bá» trÃ¹ng láº·p theo tiÃªu Ä‘á», giá»¯ má»¥c Ä‘áº§u tiÃªn
```{r}
tltk_unique <- tltk %>% 
  distinct(TITLE, .keep_all = TRUE)
```

## Loáº¡i bá» trÃ¹ng láº·p theo tiÃªu Ä‘á» vÃ  nÄƒm xuáº¥t báº£n, giá»¯ má»¥c Ä‘áº§u tiÃªn

```{r}
tltk_unique2 <- tltk %>%
  distinct(TITLE, YEAR, .keep_all = TRUE)
```

# Xuáº¥t ra file bib má»›i (Ä‘Ã£ lÃ m sáº¡ch)
```{r}
#| echo: false
df2bib(tltk_unique, file = "cleaned_references.bib")
```


