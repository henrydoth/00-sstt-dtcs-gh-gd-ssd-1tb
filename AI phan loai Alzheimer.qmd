---
title: "AI phÃ¢n loáº¡i Alzheimer theo thá»ƒ YHCT"
author: "Huong"
format:
  html:
    self-contained: true
editor: visual
---

```{r}
library(ggplot2)
# ðŸ“¦ ThÆ° viá»‡n cáº§n thiáº¿t
library(dplyr)
library(caret)
library(tibble)
library(glue)
library(randomForest)
library(flextable)

df <- read.csv( "alzheimer_data.csv") 

# ðŸ‘¨â€ðŸ”¬ 2. Train/Test & MÃ´ hÃ¬nh
splitIndex <- createDataPartition(df$the_benh, p = 0.7, list = FALSE)
train <- df[splitIndex, ] %>%
  mutate(the_benh = factor(the_benh))

test <- df[-splitIndex, ] %>%
  mutate(the_benh = factor(the_benh, levels = levels(train$the_benh)))

model_rf <- train(the_benh ~ ., data = train,
                  method = "rf",
                  trControl = trainControl(method = "cv", number = 5))

# ðŸ“Š 3. Dá»± Ä‘oÃ¡n & Ä‘Ã¡nh giÃ¡ (dÃ¹ng %>% vÃ  sá»­a lá»—i levels)
conf <- predict(model_rf, test) %>% 
  factor(levels = levels(test$the_benh)) %>% 
  confusionMatrix(reference = test$the_benh)

print(conf)

# ðŸ“ˆ 3b. Biá»ƒu Ä‘á»“ phÃ¢n bá»‘ thá»ƒ bá»‡nh (test set)
test %>% 
  mutate(du_doan = predict(model_rf, newdata = test)) %>% 
  ggplot(aes(x = du_doan, fill = the_benh)) + 
  geom_bar(position = "dodge") + 
  labs(title = "So sÃ¡nh thá»ƒ bá»‡nh thá»±c táº¿ vÃ  dá»± Ä‘oÃ¡n",
       x = "Thá»ƒ bá»‡nh dá»± Ä‘oÃ¡n", y = "Sá»‘ lÆ°á»£ng") +
  theme_minimal()

# ðŸ§˜â€â™€ï¸ 4. Gá»£i Ã½ bÃ i táº­p dÆ°á»¡ng sinh
tibble(the_benh = predict(model_rf, newdata = test[1, ])) %>% 
  left_join(
    tribble(
      ~the_benh, ~bai_tap_goi_y,
      "TÃ¢m tháº­n hÆ°", "Dá»‹ch cÃ¢n kinh, thá»Ÿ 4 thá»i, khÃ­ cÃ´ng tÄ©nh",
      "Can khÃ­ uáº¥t", "ThÃ¡i cá»±c quyá»n, vá»— trÃ¡n â€“ thÆ° giÃ£n",
      "ÄÃ m trá»c trá»Ÿ khiáº¿u", "Vá»— lÆ°ng, xoay hÃ´ng, khÃ­ cÃ´ng Ä‘á»™ng"
    ),
    by = "the_benh"
  ) %>% 
  {
    cat(glue("ðŸ”Ž Thá»ƒ bá»‡nh dá»± Ä‘oÃ¡n: {.$the_benh}\nðŸ§˜ Gá»£i Ã½ bÃ i táº­p: {.$bai_tap_goi_y}"))
    flextable(.)
  }
```
