---
title: "Đề tài cơ sở"
subtitle: "SSTT"
author: "Đỗ thanh Liêm"
date: today
format:
    docx:
      toc: false
      number-sections: false
      fig-dpi: 300          # optional for PNG fallback
      dev: dml              # chèn ggplot dạng vector
      reference-doc: sstt_dtcs_quato_words_input.docx
      fig-align: center
      

#bibliography: sstt_reference.bib
bibliography: sstt_reference.bib

csl: ama-brackets.csl

lang: vi
language:
  labels:
    fig: Hình
editor: source
---

```{r}
#| include: false
# thư viện
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
  dplyr, tidyr, forcats, haven,
  ggplot2, lubridate, glue, flextable,
  officer, officedown, jpeg, png, grid,
  tidyverse, purrr, RColorBrewer, emo, janitor, effectsize, patchwork, scale, stringr
)
```

```{r thiết_lập_mặc_định, include=FALSE}
# 📦 Thiết lập mặc định cho flextable
set_flextable_defaults(
  font.family = "Times New Roman",
  font.size = 11,
  align = "center",
  padding = 3,
  theme_fun = theme_booktabs,
  layout = "autofit",
  width = 1,
  decimal.mark = ",",     # ✅ Dấu phẩy kiểu Việt
  big.mark = ".",         # ✅ Ngăn cách hàng nghìn
  na_str = "-"            # ✅ Hiển thị NA là "-"
)

# 🎨 Thiết lập theme ggplot2 toàn cục
theme_set(
  theme_minimal(base_family = "Times New Roman") +
    theme(
      text = element_text(family = "Times New Roman"),
      plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
      axis.title = element_text(size = 12),
      axis.text = element_text(size = 11),
      legend.text = element_text(size = 11),
      legend.title = element_text(size = 11),
      strip.text = element_text(size = 12)
    )
)

# 📊 Thiết lập chunk mặc định cho biểu đồ
knitr::opts_chunk$set(
  fig.align = "center",   # ✅ Căn giữa
  out.width = "100%",     # ✅ Fit chiều ngang Word
  fig.asp = 0.618
)

# 🔧 Các tùy chọn R chung
options(OutDec = ",")     # ✅ Dấu phẩy cho số thập phân

# 🎨 Ghi đè palette mặc định
scale_color_discrete <- function(...) scale_color_brewer(palette = "Set1", ...)
scale_fill_discrete  <- function(...) scale_fill_brewer(palette = "Pastel2", ...)
```

```{r}
#| include: false
ft_vn <- function(df) {
  flextable(df) %>%
    colformat_num(decimal.mark = ",", big.mark = ".", na_str = "-") %>%
    autofit()
}

```

```{r}
#| label: to màu canh cho văn bản
#| include: false
# Hàm tô màu xanh cho văn bản inline Word
text_blue <- function(text) {
  ftext(
    text,
    fp_text_lite(
      color = "blue",
      font.family = "Times New Roman"
    )
  )
}
```

```{r}
#| include: false

current_datetime <- now()

thu <- c("CHỦ NHẬT", "THỨ 2", "THỨ 3", "THỨ 4", "THỨ 5", "THỨ 6", "THỨ 7")[wday(current_datetime)]

# Giờ 12h có AM/PM, sau đó dịch sang tiếng Việt
gio <- format(current_datetime, "%I:%M %p") %>%
  str_replace("AM", "sáng") %>%
  str_replace("PM", "chiều")

ngay <- day(current_datetime)
thang <- month(current_datetime)
nam <- year(current_datetime)

formatted_datetime <- glue("{gio}, {thu}, NGÀY {ngay} THÁNG {thang} NĂM {nam}")

```

::: {custom-style="CAN GIUA DAM 14 ONE"}
LỜI NÓI ĐẦU
:::

```{r}
#| include: false

# Danh sách lời cảm ơn và màu chữ
messages <- c(
  "Vợ và các con vì đã cho tôi tình yêu, ý nghĩa cuộc đời",
  "Bố mẹ vì đã cho tôi cuộc đời",
  "Thầy cô vì đã cho tôi kiến thức",
  "Bạn bè vì đã hết lòng giúp đỡ, động viên",
  "Đồng nghiệp vì đã hợp tác và giúp đỡ"
)

colors <- c("red", "blue", "green", "orange", "purple")

# Chọn ngẫu nhiên một câu + màu
msg <- sample(messages, 1)
color <- sample(colors, 1)

# Câu cảm ơn (font Segoe Print, size 16, màu ngẫu nhiên)
ft_msg <- ftext(
  glue("Tôi xin chân thành cảm ơn {msg}."), 
  prop = fp_text(font.family = "Segoe Print", font.size = 16, color = color)
)

# Tên người ký (Segoe Print, size 16, không màu)
ft_name <- ftext(
  "Đỗ Thanh Liêm", 
  prop = fp_text(font.family = "Segoe Print", font.size = 16)
)
```

`r ft_msg`

`r ft_name`

```{=openxml}
<w:p><w:r><w:br/></w:r></w:p>
```
```{r}
#| echo: false
#| fig-align: center
# fig-cap: Hình ảnh ngẫu nhiên
#| out-width: 4in


imgs <- list.files("images", pattern = "\\.(jpg|jpeg|png)$", full.names = TRUE)
img <- sample(imgs, 1)

ext <- tools::file_ext(img)

# Read and display image based on format
if (ext == "png") {
  img_data <- png::readPNG(img)
} else {
  img_data <- jpeg::readJPEG(img)
}

grid::grid.raster(img_data)
```

```{r}
#| echo: false


quotes <- c(
  "The best way to predict the future is to invent it. – Alan Kay",
  "Life is what happens when you're busy making other plans. – John Lennon",
  "Do not dwell in the past, do not dream of the future, concentrate the mind on the present moment. – Buddha",
  "Success is not final, failure is not fatal: It is the courage to continue that counts. – Winston Churchill",
  "In the middle of difficulty lies opportunity. – Albert Einstein"
)

quote <- sample(quotes, 1)

# Print one line break before the table
cat("\n")

ft <- flextable(data.frame(Quote = quote))
ft <- set_table_properties(ft, width = .75, layout = "autofit")
ft <- italic(ft, j = "Quote")
ft <- align(ft, align = "center", part = "all")
ft <- border_remove(ft)
ft <- padding(ft, padding = 6)
ft <- fontsize(ft, size = 16, part = "all")
ft <- color(ft, color = "blue", part = "all")

ft

# Print one line break after the table
cat("\n")
```

TP Hồ Chí Minh: `r formatted_datetime`

# MÃ LỆNH

## Tải dữ liệu và xử lý

```{r}
#| echo: true
#| message: false
#| warning: false
#| paged-print: false


df_raw <- read_sav("sstt304_28_03_24.sav", encoding = "latin1")
write_csv(df_raw, "sstt304_clean.csv")
```

```{r}
#| echo: true
#| message: false
#| warning: false
#| paged-print: false


df <-  read_csv("sstt304_clean.csv") 
df <- df %>%
    dplyr::filter(new.old.tests != 1, mmse.new <=29) %>%
    drop_na(mmse.new)

```

```{r}
#| echo: true
#| message: false
#| warning: false
#| paged-print: false

df <- df %>%
  filter(
    !is.na(date.visit),
    !is.na(year.born),
    !is.na(mmse.new),
    !is.na(gender)
  ) %>%
  mutate(
    year.visit = year(date.visit),
    tuoi = year.visit - year.born,

    gender = case_when(
      gender == 1 ~ "Nam",
      gender == 2 ~ "Nữ",
      TRUE ~ NA_character_
    ),
    gender = factor(gender, levels = c("Nam", "Nữ")),

    edu = case_when(
      edu.level == 1 ~ "Tiểu học",
      edu.level %in% c(2, 3) ~ "Trung học",
      edu.level == 4 ~ "Đại học",
      TRUE ~ NA_character_
    ),
    edu = factor(edu, levels = c("Tiểu học", "Trung học", "Đại học")),

    diagno_lam_sang = case_when(
      diagno == 1 ~ "Suy giảm nhận thức nhẹ",
      diagno == 2 ~ "Suy giảm nhận thức chủ quan",
      diagno == 3 ~ "Alzheimer",
      diagno == 4 ~ "Sa sút trí tuệ mạch máu",
      diagno == 5 ~ "Sa sút trí tuệ thùy trán thái dương",
      diagno == 7 ~ "Sa sút trí tuệ hỗn hợp",
      diagno == 8 ~ "Sa sút trí tuệ do Parkinson",
      diagno == 9 ~ "Sa sút trí tuệ khác",
      TRUE ~ NA_character_
    )
  ) %>%
  filter(
    tuoi >= 40,
    diagno_lam_sang != "Suy giảm nhận thức chủ quan"
  ) %>%
  mutate(
    nhom_tuoi = case_when(
      tuoi < 50 ~ "40–49",
      tuoi < 60 ~ "50–59",
      tuoi < 70 ~ "60–69",
      tuoi < 80 ~ "70–79",
      TRUE      ~ "80+"
    ),
    diagno_lam_sang = factor(diagno_lam_sang, levels = c(
      "Suy giảm nhận thức nhẹ",
      "Alzheimer",
      "Sa sút trí tuệ mạch máu",
      "Sa sút trí tuệ hỗn hợp",
      "Sa sút trí tuệ thùy trán thái dương",
      "Sa sút trí tuệ do Parkinson",
      "Sa sút trí tuệ khác"
    )),

    phan_loan_roi_loan_nhan_thuc_tieu_chuan_vang = case_when(
      diagno_lam_sang == "Suy giảm nhận thức nhẹ" ~ "MCI",
      !is.na(diagno) ~ "Sa sút trí tuệ",
      TRUE ~ NA_character_
    ),
    phan_loan_roi_loan_nhan_thuc_tieu_chuan_vang = factor(
      phan_loan_roi_loan_nhan_thuc_tieu_chuan_vang,
      levels = c("MCI", "Sa sút trí tuệ")
    ),

    chan_doan_giai_doan_lam_sang = case_when(
      stage == 1 ~ "Sa sút trí tuệ nhẹ",
      stage == 2 ~ "Sa sút trí tuệ trung bình",
      stage == 3 ~ "Sa sút trí tuệ nặng",
      TRUE ~ NA_character_
    ),
    chan_doan_giai_doan_lam_sang = factor(
      chan_doan_giai_doan_lam_sang,
      levels = c("Sa sút trí tuệ nhẹ", "Sa sút trí tuệ trung bình", "Sa sút trí tuệ nặng")
    ),

    phan_loan_roi_loan_nhan_thuc = case_when(
      mmse.new >= 26 & mmse.new <= 29 ~ "MCI",
      mmse.new < 26 ~ "Sa sút trí tuệ",
      TRUE ~ NA_character_
    ),
    phan_loan_roi_loan_nhan_thuc = factor(
      phan_loan_roi_loan_nhan_thuc,
      levels = c("MCI", "Sa sút trí tuệ")
    ),

    mmse_group = case_when(
      mmse.new >= 26 & mmse.new <= 29 ~ "Suy giảm nhận thức nhẹ",
      mmse.new >= 21 & mmse.new <= 25 ~ "Sa sút trí tuệ nhẹ",
      mmse.new >= 11 & mmse.new <= 20 ~ "Sa sút trí tuệ trung bình",
      mmse.new >= 0  & mmse.new <= 10 ~ "Sa sút trí tuệ nặng",
      TRUE ~ NA_character_
    ),
    mmse_group = factor(mmse_group, levels = c(
      "Suy giảm nhận thức nhẹ",
      "Sa sút trí tuệ nhẹ",
      "Sa sút trí tuệ trung bình",
      "Sa sút trí tuệ nặng"
    )),
    mmse_group = fct_drop(mmse_group),

    lam_sang_group = case_when(
      !is.na(chan_doan_giai_doan_lam_sang) ~ as.character(chan_doan_giai_doan_lam_sang),
      diagno_lam_sang == "Suy giảm nhận thức nhẹ" ~ "Suy giảm nhận thức nhẹ",
      TRUE ~ NA_character_
    ),
    lam_sang_group = factor(lam_sang_group, levels = c(
      "Suy giảm nhận thức nhẹ",
      "Sa sút trí tuệ nhẹ",
      "Sa sút trí tuệ trung bình",
      "Sa sút trí tuệ nặng"
    ))
  )
```

## Đặc điểm mẫu nghiên cứu

### Đặc điểm theo tuổi

```{r}
# 📦 Làm sạch dữ liệu và gán nhãn nhóm
df_clean <- df %>%
  filter(!is.na(tuoi), !is.na(phan_loan_roi_loan_nhan_thuc)) %>%
  mutate(
    nhom_nhan_thuc = recode(phan_loan_roi_loan_nhan_thuc,
                            "MCI" = "Suy giảm nhận thức nhẹ",
                            "Sa sút trí tuệ" = "Sa sút trí tuệ")
  )

# 📊 Tính thống kê mô tả theo nhóm
age_summary <- df_clean %>%
  group_by(nhom_nhan_thuc) %>%
  summarise(
    mean_age = mean(tuoi, na.rm = TRUE),
    sd_age   = sd(tuoi, na.rm = TRUE),
    .groups = "drop"
  )

# 🔍 Tách từng nhóm
sgnt <- age_summary %>% filter(nhom_nhan_thuc == "Suy giảm nhận thức nhẹ")
sstt <- age_summary %>% filter(nhom_nhan_thuc == "Sa sút trí tuệ")

# 📋 Tạo bảng mô tả thống kê
table_tuoi <- df_clean %>%
  group_by(nhom_nhan_thuc) %>%
  summarise(
    `Trung bình ± SD` = sprintf("%.1f ± %.1f", mean(tuoi, na.rm = TRUE), sd(tuoi, na.rm = TRUE)) %>% str_replace_all("\\.", ","),
    `Trung vị (Q1–Q3)` = sprintf("%.1f (%.1f–%.1f)",
                                 median(tuoi, na.rm = TRUE),
                                 quantile(tuoi, 0.25, na.rm = TRUE),
                                 quantile(tuoi, 0.75, na.rm = TRUE)) %>% str_replace_all("\\.", ","),
    `Min – Max` = sprintf("%d – %d", min(tuoi, na.rm = TRUE), max(tuoi, na.rm = TRUE)),
    .groups = "drop"
  ) %>%
  pivot_longer(-nhom_nhan_thuc, names_to = "Chỉ số", values_to = "Giá trị") %>%
  pivot_wider(names_from = nhom_nhan_thuc, values_from = "Giá trị")

# 🧪 Kiểm định t-test
p_val <- t.test(tuoi ~ nhom_nhan_thuc, data = df_clean)$p.value
p_val_fmt <- ifelse(p_val < 0.001, "≤ 0,001", str_replace(sprintf("%.3f", p_val), "\\.", ","))  # ✅ Đã sửa dấu

# 🖼️ Bảng flextable
final_table <- table_tuoi %>%
  mutate(`Giá trị p` = if_else(`Chỉ số` == "Trung bình ± SD", p_val_fmt, ""))

ft_tuoi <- flextable(final_table) %>%
  autofit() %>%
  align(align = "center", part = "all") %>%
  bold(i = 1, part = "header") %>%
  set_caption("Bảng: So sánh tuổi giữa các nhóm nhận thức (định dạng tiếng Việt)") %>%
  set_table_properties(width = 1, layout = "autofit")

ft_tuoi

# 📈 Vẽ biểu đồ ggplot
tuoi_gp <- ggplot(df_clean, aes(x = nhom_nhan_thuc, y = tuoi, fill = nhom_nhan_thuc)) +
  geom_boxplot(outlier.shape = NA, alpha = 0.7) +
  geom_jitter(aes(color = nhom_nhan_thuc), width = 0.2, size = 1.5, alpha = 0.5) +
  labs(x = NULL, y = "Tuổi") +
  theme_minimal(base_family = "Times New Roman") +
  theme(
    legend.position = "none",
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 11)
  )

tuoi_gp

# ✍️ Inline: kết quả bảng
inline_bang_tuoi_ketqua <- glue(
  "Tuổi trung bình nhóm Suy giảm nhận thức nhẹ là {scales::number(sgnt$mean_age, accuracy = 0.1, decimal.mark = ',')} ± {scales::number(sgnt$sd_age, accuracy = 0.1, decimal.mark = ',')} tuổi; ",
  "nhóm Sa sút trí tuệ là {scales::number(sstt$mean_age, accuracy = 0.1, decimal.mark = ',')} ± {scales::number(sstt$sd_age, accuracy = 0.1, decimal.mark = ',')} tuổi. ",
  "Sự khác biệt có ý nghĩa thống kê với p {p_val_fmt}."
)

# ✍️ Inline: kết quả biểu đồ
inline_bieudo_tuoi_ketqua <- "Biểu đồ hộp cho thấy sự khác biệt trong phân bố tuổi giữa hai nhóm nhận thức."

# 📊 Tính tuổi trung bình toàn mẫu
mean_age_all <- mean(df_clean$tuoi, na.rm = TRUE)

# ✍️ Inline: bàn luận tổng hợp có tuổi toàn mẫu
inline_tuoi_banluan <- case_when(
  sgnt$mean_age < sstt$mean_age ~ glue(
    "Trong nghiên cứu này, tuổi trung bình toàn mẫu nghiên cứu là {scales::number(mean_age_all, accuracy = 0.1, decimal.mark = ',')} tuổi; ",
    "tuổi trung bình nhóm Suy giảm nhận thức nhẹ là {scales::number(sgnt$mean_age, accuracy = 0.1, decimal.mark = ',')} tuổi, ",
    "nhóm Sa sút trí tuệ là {scales::number(sstt$mean_age, accuracy = 0.1, decimal.mark = ',')} tuổi. ",
    "Nhóm Sa sút trí tuệ có xu hướng lớn tuổi hơn, cho thấy tuổi có thể liên quan đến mức độ suy giảm nhận thức."
  ),
  sgnt$mean_age > sstt$mean_age ~ "Trong nghiên cứu này, nhóm Suy giảm nhận thức nhẹ có xu hướng lớn tuổi hơn, cho thấy có thể tồn tại các yếu tố ngoài tuổi ảnh hưởng đến mức độ nhận thức.",
  TRUE ~ "Trong nghiên cứu này, hai nhóm có độ tuổi tương đương, gợi ý rằng tuổi không phải là yếu tố phân biệt rõ giữa các mức độ nhận thức."
)
```

#### Bảng đặc điểm tuổi

#### Biểu đồ theo tuổi

```{r}
#| echo: true
#| message: false
#| warning: false
#| paged-print: false
tuoi_gp <- ggplot(df, aes(x = phan_loan_roi_loan_nhan_thuc, y = tuoi, fill = phan_loan_roi_loan_nhan_thuc)) +
  geom_boxplot(outlier.shape = NA, alpha = 0.7) +
  geom_jitter(
    aes(color = phan_loan_roi_loan_nhan_thuc),
    width = 0.2, size = 1.5, alpha = 0.5
  ) +
  labs(
    x = NULL,  
    y = "Tuổi"
  ) +
  theme_minimal(base_family = "Times New Roman") +
  scale_x_discrete(labels=c("MCI" = "Suy giảm nhận thức nhẹ ", "Sa sút trí tuệ" = "Sa sút trí tuệ"))+
  theme(
    legend.position = "none",
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 11)
  )

```

```{r}
#| echo: true
#| message: false
#| warning: false
#| paged-print: false
tuoi_gp
```

#### Bảng theo nhóm tuổi

```{r}
# 🔄 Chuẩn hóa biến và gán nhãn
levels_nhom_tuoi <- c("40–49", "50–59", "60–69", "70–79", "80+")
df <- df %>%
  mutate(
    nhom_tuoi = factor(nhom_tuoi, levels = levels_nhom_tuoi),
    chuan_doan_label = recode(phan_loan_roi_loan_nhan_thuc,
                              "MCI" = "Suy giảm nhận thức nhẹ",
                              "Sa sút trí tuệ" = "Sa sút trí tuệ")
  )

# 📋 Tạo bảng tần số theo nhóm tuổi (làm hàng) và chẩn đoán (làm cột)
table_freq <- df %>%
  count(nhom_tuoi, chuan_doan_label) %>%
  group_by(nhom_tuoi) %>%
  mutate(percent = n / sum(n) * 100) %>%
  ungroup() %>%
  mutate(`Tần số (%)` = sprintf("%d (%.1f%%)", n, percent)) %>%
  select(`Nhóm tuổi` = nhom_tuoi, `Chẩn đoán` = chuan_doan_label, `Tần số (%)`) %>%
  pivot_wider(
    names_from = `Chẩn đoán`,
    values_from = `Tần số (%)`,
    values_fill = "-"
  )

# 🔍 Kiểm định Chi-squared
chisq_data <- table(df$chuan_doan_label, df$nhom_tuoi)
p_val <- chisq.test(chisq_data)$p.value
formatted_p <- ifelse(p_val < 0.001, "≤ 0,001", str_replace(sprintf("%.3f", p_val), "\\.", ","))

# ➕ Thêm p-value vào bảng
table_freq$`Giá trị p` <- c(formatted_p, rep("", nrow(table_freq) - 1))

# 📊 Bảng flextable
ft_freq_p <- flextable(table_freq) %>%
  autofit() %>%
  align(align = "center", part = "all") %>%
  bold(i = 1, part = "header") %>%
  bold(i = which(
    table_freq$`Giá trị p` != "" &
    table_freq$`Giá trị p` != "-" &
    as.numeric(gsub("[≤< ]", "", table_freq$`Giá trị p`)) < 0.05
  ), j = "Giá trị p", part = "body") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  fontsize(size = 11, part = "all") %>%
  set_table_properties(width = 1, layout = "autofit")

ft_freq_p

# ✍️ Inline: bảng
inline_bang_nhom_tuoi_ketqua <- glue("Tần số nhóm tuổi theo chẩn đoán có độ lệch khác nhau rõ rệt, với p {formatted_p}.")

# 📈 Biểu đồ boxplot
nhom_tuoi_gp <- ggplot(df, aes(x = nhom_tuoi, y = tuoi, fill = chuan_doan_label)) +
  geom_boxplot(outlier.shape = NA, alpha = 0.7, position = position_dodge(width = 0.75)) +
  labs(
    x = "Nhóm tuổi",
    y = "Tuổi",
    fill = "Chẩn đoán"
  ) +
  theme_minimal(base_family = "Times New Roman") +
  theme(
    text = element_text(family = "Times New Roman"),
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 11),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 11),
    legend.position = "top"
  )

nhom_tuoi_gp

# ✍️ Inline: biểu đồ
inline_bieudo_nhom_tuoi_ketqua <- "Biểu đồ boxplot cho thấy xu hướng tăng tuổi đồng thời với mức độ nhận thức giảm."

# ✍️ Inline: bàn luận
inline_nhom_tuoi_banluan <- "Nhóm Sa sút trí tuệ chiếm tỷ lệ cao nhất trong nhóm tuổi ≥ 80, trong khi nhóm Suy giảm nhận thức nhẹ phổ biến hơn trong nhóm tuổi 60–69. Xu hướng này gợi ý mối quan hệ tạm thời giữa tuổi và mức độ sa sút nhận thức."

```

### Đặc điểm giới tính

```{r}
#| echo: true
#| message: false
#| warning: false
#| paged-print: false
# 🔍 Phân tích giới tính theo nhóm chẩn đoán

# 🧮 Hàm phụ: Tính phần trăm nữ theo nhóm
lay_phan_tram_nu <- function(nhom) {
  df %>%
    filter(phan_loan_roi_loan_nhan_thuc == nhom, gender == "Nữ") %>%
    summarise(percent = n() / sum(df$phan_loan_roi_loan_nhan_thuc == nhom) * 100) %>%
    pull(percent) %>%
    round(1)
}

# 📊 Tóm tắt dữ liệu giới tính
gioitinh_summary <- df %>%
  mutate(chuan_doan_label = recode(phan_loan_roi_loan_nhan_thuc, "MCI" = "Suy giảm nhận thức nhẹ")) %>%
  count(chuan_doan_label, gender) %>%
  group_by(chuan_doan_label) %>%
  mutate(percent = n / sum(n) * 100) %>%
  ungroup()

# 📋 Bảng flextable
bang_gioitinh <- gioitinh_summary %>%
  mutate(`Tần số (%)` = sprintf("%d (%.1f%%)", n, percent)) %>%
  select(`Chẩn đoán` = chuan_doan_label, `Giới tính` = gender, `Tần số (%)`) %>%
  pivot_wider(names_from = `Giới tính`, values_from = `Tần số (%)`, values_fill = "-")

# 🧪 Tính p-value
p_val_gender <- chisq.test(table(df$phan_loan_roi_loan_nhan_thuc, df$gender))$p.value
formatted_p_gender <- ifelse(p_val_gender < 0.001, "≤ 0,001", str_replace(sprintf("%.3f", p_val_gender), "\\.", ","))

bang_gioitinh$`Giá trị p` <- c(formatted_p_gender, rep("", nrow(bang_gioitinh) - 1))

ft_gender <- flextable(bang_gioitinh) %>%
  autofit() %>%
  align(align = "center", part = "all") %>%
  bold(i = 1, part = "header") %>%
  bold(i = which(
    bang_gioitinh$`Giá trị p` != "" &
    bang_gioitinh$`Giá trị p` != "-" &
    as.numeric(gsub("[<≤ ]", "", bang_gioitinh$`Giá trị p`)) < 0.05
  ), j = "Giá trị p", part = "body") %>%
  set_caption("Bảng: Phân bố giới tính theo nhóm nhận thức (tô đậm nếu p < 0.05)") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  fontsize(size = 11, part = "all") %>%
  set_table_properties(width = 1, layout = "autofit")

ft_gender

# 📉 Biểu đồ giới tính
gioitinh_bar_percent <- ggplot(gioitinh_summary, aes(x = chuan_doan_label, y = n, fill = gender)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8)) +
  geom_text(
    aes(label = sprintf("%.1f%%", percent)),
    position = position_dodge(width = 0.8),
    vjust = -0.3,
    size = 3.5,
    family = "Times New Roman"
  ) +
  labs(x = NULL, y = "Số lượng bệnh nhân", fill = "Giới tính") +
  theme_minimal(base_family = "Times New Roman") +
  theme(
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 11),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 11)
  )

gioitinh_bar_percent



# ✍️ Inline bàn luận
gioitinh_mci <- lay_phan_tram_nu("MCI")
gioitinh_sstt <- lay_phan_tram_nu("Sa sút trí tuệ")

inline_bang_gioitinh_ketqua <- glue(
  "ở nhóm Suy giảm nhận thức nhẹ, nữ giới chiếm {gioitinh_mci}%, ",
  "trong khi nhóm Sa sút trí tuệ chiếm {gioitinh_sstt}%. ",
  "Sự khác biệt này ", ifelse(p_val_gender < 0.05, "có", "không có"),
  " ý nghĩa thống kê với p = {formatted_p_gender}."
)

# ✍️ Inline kết quả biểu đồ
inline_bieudo_gioitinh_ketqua <- "Biểu đồ cột cho thấy xu hướng lệch giới giữa hai nhóm chẩn đoán."


inline_bang_gioitinh_banluan <- glue(
  "Kết quả nghiên cứu về giới tính cho thấy: ở nhóm Suy giảm nhận thức nhẹ, nữ giới chiếm {gioitinh_mci}%, ",
  "trong khi nhóm Sa sút trí tuệ chiếm {gioitinh_sstt}%. "
)


```

### Đặc điểm trình độ học vấn

```{r}
#| echo: true

# 📊 Tóm tắt dữ liệu học vấn 🧠
hocvan_summary <- df %>%
  filter(phan_loan_roi_loan_nhan_thuc %in% c("MCI", "Sa sút trí tuệ")) %>%  # 💡 chỉ lấy 2 nhóm
  count(phan_loan_roi_loan_nhan_thuc, edu) %>%
  group_by(phan_loan_roi_loan_nhan_thuc) %>%
  mutate(percent = n / sum(n) * 100) %>%
  ungroup()

# 🧮 Tạo bảng trình độ học vấn với 2 cột MCI, SSTT
table_edu <- hocvan_summary %>%
  mutate(`Tần số (%)` = sprintf("%d (%.1f%%)", n, percent) %>% str_replace_all("\\.", ",")) %>%
  select(`Chẩn đoán` = phan_loan_roi_loan_nhan_thuc, `Trình độ học vấn` = edu, `Tần số (%)`) %>%
  pivot_wider(names_from = `Chẩn đoán`, values_from = `Tần số (%)`, values_fill = "-")

# 🧪 Tính p-value
chisq_edu <- table(df$phan_loan_roi_loan_nhan_thuc, df$edu)
use_fisher <- any(chisq_edu < 5)
p_val_edu <- if (use_fisher) fisher.test(chisq_edu)$p.value else chisq.test(chisq_edu)$p.value
formatted_p_edu <- ifelse(p_val_edu < 0.001, "≤ 0,001", str_replace(sprintf("%.3f", p_val_edu), "\\.", ","))

# ➕ Thêm dòng p-value
table_edu$`Giá trị p` <- c(formatted_p_edu, rep("", nrow(table_edu) - 1))

# 📋 Bảng flextable
ft_edu <- flextable(table_edu) %>%
  autofit() %>%
  align(align = "center", part = "all") %>%
  bold(i = 1, part = "header") %>%
  bold(i = which(
    table_edu$`Giá trị p` != "" &
    table_edu$`Giá trị p` != "-" &
    as.numeric(gsub("[≤< ]", "", table_edu$`Giá trị p`)) < 0.05
  ), j = "Giá trị p", part = "body") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  fontsize(size = 11, part = "all") %>%
  set_table_properties(width = 1, layout = "autofit") %>%
  set_caption("Bảng: Phân bố trình độ học vấn theo nhóm nhận thức")

# 🎨 Biểu đồ ggplot trình độ học vấn
hocvan_bar_percent <- ggplot(hocvan_summary, aes(x = edu, y = percent, fill = phan_loan_roi_loan_nhan_thuc)) +
  geom_col(position = position_dodge(width = 0.8)) +
  geom_text(
    aes(label = str_replace(sprintf("%.1f%%", percent), "\\.", ",")),
    position = position_dodge(width = 0.8),
    vjust = -0.3,
    size = 3.5,
    family = "Times New Roman"
  ) +
  labs(
    x = "Trình độ học vấn",
    y = "Tỷ lệ (%)",
    fill = "Nhóm nhận thức"
  ) +
  theme_minimal(base_family = "Times New Roman") +
  theme(
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 11),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 11),
    legend.position = "top"
  )

# ✍️ Inline mô tả bảng
lay_tyle_hocvan <- function(nhom, bac) {
  ket_qua <- hocvan_summary %>%
    filter(phan_loan_roi_loan_nhan_thuc == nhom, edu == bac) %>%
    pull(percent)
  if (length(ket_qua) == 0) return(0) else return(round(ket_qua, 1))
}

hv_mci_daihoc <- lay_tyle_hocvan("MCI", "Đại học")
hv_sstt_daihoc <- lay_tyle_hocvan("Sa sút trí tuệ", "Đại học")

# 🧾 Inline mô tả bảng
inline_table_hocvan <- glue(
  "Tỷ lệ trình độ Đại học cao nhất ghi nhận ở nhóm Suy giảm nhận thức nhẹ ({hv_mci_daihoc}%) so với nhóm Sa sút trí tuệ ({hv_sstt_daihoc}%). ",
  "Giá trị p kiểm định sự khác biệt giữa hai nhóm là {formatted_p_edu}."
)

# ✏️ Inline mô tả biểu đồ có điều kiện
inline_plot_hocvan <- ifelse(
  hv_mci_daihoc > hv_sstt_daihoc,
  glue("Biểu đồ cho thấy nhóm Suy giảm nhận thức nhẹ có xu hướng đạt trình độ học vấn cao hơn."),
  glue("Biểu đồ cho thấy nhóm Sa sút trí tuệ có tỷ lệ trình độ học vấn cao hơn.")
)

# 💬 Inline bàn luận tổng quan có điều kiện
inline_banluan_hocvan <- ifelse(
  hv_mci_daihoc > hv_sstt_daihoc,
  glue("Tổng quan cho thấy nhóm Suy giảm nhận thức nhẹ có trình độ học vấn cao hơn."),
  glue("Nhóm Sa sút trí tuệ có trình độ học vấn cao hơn trong nghiên cứu này.")
)
```

### Phân tích MMSE

```{r}
#| label: khối lệnh MMSE
#| echo: true


# 🧠 Tổng hợp bảng MMSE
tab_mmse <- df %>%
  count(mmse_group, name = "n") %>%
  mutate(
    percent = round(100 * n / sum(n), 1),
    percent_vi = str_replace(format(percent, decimal.mark = ","), "\\.", ","),  # ✅ xử lý dấu , trước
    `Số lượng (Tỷ lệ %)` = glue("{n} ({percent_vi}%)"),
    nhan_day_du = case_when(
      mmse_group == "Bình thường" ~ "Bình thường",
      mmse_group == "Suy giảm nhận thức nhẹ" ~ "Suy giảm nhận thức nhẹ",
      mmse_group == "Sa sút trí tuệ nhẹ" ~ "Sa sút trí tuệ nhẹ",
      mmse_group == "Sa sút trí tuệ trung bình" ~ "Sa sút trí tuệ trung bình",
      mmse_group == "Sa sút trí tuệ nặng" ~ "Sa sút trí tuệ nặng",
      TRUE ~ as.character(mmse_group)
    )
  )

# 📋 Tạo bảng flextable
ft_mmse <- flextable(tab_mmse %>%
    select(`Phân độ MMSE` = nhan_day_du, `Số lượng (Tỷ lệ %)`)) %>%
  colformat_num(decimal.mark = ",", big.mark = ".") %>%
  set_table_properties(width = 1, layout = "autofit") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  fontsize(size = 11, part = "all") %>%
  set_caption("Bảng: Tần suất và tỷ lệ phân độ MMSE") %>%
  autofit()

# 📊✨ Biểu đồ cột MMSE theo thứ tự từ nhẹ đến nặng với nhãn không bị mất
ggplot_mmse <- tab_mmse %>%
  mutate(nhan_day_du = factor(
    nhan_day_du,
    levels = c(
      "Suy giảm nhận thức nhẹ",
      "Sa sút trí tuệ nhẹ",
      "Sa sút trí tuệ trung bình",
      "Sa sút trí tuệ nặng"
    )
  )) %>%
  ggplot(aes(x = nhan_day_du, y = n, fill = nhan_day_du)) +
  geom_col(width = 0.6) +
  geom_text(
    aes(label = `Số lượng (Tỷ lệ %)`),
    vjust = -0.5,
    size = 3.5,
    family = "Times New Roman"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +  # ✅ tạo khoảng trống phía trên
  scale_fill_brewer(palette = "Pastel1") +
  labs(y = "Số lượng") +
  theme_minimal(base_family = "Times New Roman") +
  theme(
    axis.text.x = element_text(angle = 30, hjust = 1),
    axis.title.x = element_blank(), 
    axis.text = element_text(size = 11),
    legend.position = "none"
  )

# ✏️ Inline mô tả bảng
mmse_top <- tab_mmse %>% slice_max(order_by = n, n = 1)
inline_bang_mmse <- glue(
  "Bảng cho thấy phân độ MMSE phổ biến nhất là **{mmse_top$nhan_day_du}**, ",
  "chiếm tỷ lệ {format(mmse_top$percent, decimal.mark = ',')}%."
)

# 📈 Inline mô tả biểu đồ
tab_mmse_xu <- tab_mmse %>%
  mutate(nhom = case_when(
    str_detect(mmse_group, "Suy giảm") ~ "Suy giảm nhận thức nhẹ",
    str_detect(mmse_group, "Sa sút") ~ "Sa sút trí tuệ",
    mmse_group == "Bình thường" ~ "Bình thường"
  )) %>%
  group_by(nhom) %>%
  summarise(tong = sum(n), .groups = "drop")

top_xu <- tab_mmse_xu %>% slice_max(order_by = tong, n = 1)
nhom_dich <- top_xu$nhom
inline_bieudo_mmse <- glue(
  "Biểu đồ thể hiện xu hướng tập trung vào nhóm **{nhom_dich}**."
)

# 🧠 Inline bàn luận ngắn gọn
top2 <- tab_mmse %>% arrange(desc(n)) %>% slice_head(n = 2)
inline_mmse_banluan <- text_blue(ifelse(
  top2$nhan_day_du[1] != top2$nhan_day_du[2],
  glue("Hai phân độ phổ biến nhất là {top2$nhan_day_du[1]} (chiếm {top2$percent[1]}%) và {top2$nhan_day_du[2]} (chiếm {top2$percent[2]}%)."),
  glue("Phân độ phổ biến nhất là **{top2$nhan_day_du[1]}**, chiếm {top2$percent[1]}%")
))

# 🔢 Tính phần trăm người thuộc nhóm MCI (MMSE 26–29)
percent_mci <- tab_mmse %>%
  filter(mmse_group == "Suy giảm nhận thức nhẹ") %>%
  summarise(p = sum(n) / sum(tab_mmse$n)) %>%
  pull(p)

# 📘 Inline mô tả với text_blue() và phần trăm kiểu Việt (dấu phẩy)
inline_mci_mota_phantram_banluan <- text_blue(glue(
  "Trong nghiên cứu này, có {scales::percent(percent_mci, accuracy = 0.1, decimal.mark = ',')} người tham gia được phân vào nhóm MCI (MMSE 26–29)."
))
# 🧠 Inline bàn luận ngắn gọn ve tỉ lệ các nhón 
# 🧠 Tính tỷ lệ nhóm "Sa sút trí tuệ nặng"
prop_nang <- df %>%
  summarise(ti_le = mean(mmse_group == "Sa sút trí tuệ nặng") * 100) %>%
  pull(ti_le)

# 📌 Tạo chuỗi mô tả inline với định dạng phần trăm kiểu Việt Nam
ti_le_sstt_nang_theo_mmse <- text_blue(glue(
  "tỷ lệ nhóm Sa sút trí tuệ nặng là {scales::number(prop_nang, accuracy = 0.1, decimal.mark = ',')}%"
))
```

### Đặc điểm các test nhận thức

```{r}
# 🧠 Biến thần kinh nhận thức và nhãn
tests_nhanthuc <- c(
  "Im.recall1", "de.recall1", "de.reg1",
  "TMT.A.time", "TMT.B.time",
  "DS.forward1", "DS.backrward1",
  "animal.test1", "clock.drawing1"
)

label_nhanthuc <- c(
  "Nhớ lại ngay", "Nhớ lại có trì hoãn", "Nhận biết có trì hoãn",
  "Nối số", "Nối số-chữ",
  "Đọc số xuôi", "Đọc số ngược",
  "Lưu loát ngôn ngữ", "Vẽ đồng hồ"
)
names(label_nhanthuc) <- tests_nhanthuc

# 📋 Tổng hợp bảng mô tả + kiểm định
table_nhanthuc_group <- purrr::map_dfr(tests_nhanthuc, function(var) {
  df_sub <- df %>%
    select(phan_loan_roi_loan_nhan_thuc, !!sym(var)) %>%
    filter(!is.na(phan_loan_roi_loan_nhan_thuc), !is.na(!!sym(var)))

  # Kiểm định
  formatted_p <- "-"
  if (n_distinct(df_sub$phan_loan_roi_loan_nhan_thuc) >= 2) {
    group_vals <- split(df_sub[[var]], df_sub$phan_loan_roi_loan_nhan_thuc)
    if (length(group_vals[[1]]) >= 3 && length(group_vals[[2]]) >= 3) {
      shapiro1 <- shapiro.test(group_vals[[1]])$p.value
      shapiro2 <- shapiro.test(group_vals[[2]])$p.value
      p_val <- tryCatch({
        if (shapiro1 > 0.05 && shapiro2 > 0.05) {
          t.test(!!sym(var) ~ phan_loan_roi_loan_nhan_thuc, data = df_sub)$p.value
        } else {
          wilcox.test(!!sym(var) ~ phan_loan_roi_loan_nhan_thuc, data = df_sub)$p.value
        }
      }, error = function(e) NA_real_)
      formatted_p <- ifelse(
        is.na(p_val), "-",
        ifelse(p_val < 0.001, "< 0,001", formatC(p_val, digits = 3, format = "f") |> str_replace_all("\\.", ","))
      )
    }
  }

  # Tóm tắt mô tả
  df_stats <- df_sub %>%
    group_by(phan_loan_roi_loan_nhan_thuc) %>%
    summarise(
      `Trung bình ± SD` = sprintf("%.1f ± %.1f", mean(!!sym(var)), sd(!!sym(var))),
      `Trung vị (Q1–Q3)` = sprintf("%.1f (%.1f–%.1f)",
                                   median(!!sym(var)),
                                   quantile(!!sym(var), 0.25),
                                   quantile(!!sym(var), 0.75)),
      `Min – Max` = sprintf("%.1f – %.1f", min(!!sym(var)), max(!!sym(var))),
      N = as.character(n()),
      .groups = "drop"
    ) %>%
    pivot_longer(-phan_loan_roi_loan_nhan_thuc, names_to = "Chỉ số", values_to = "Giá trị") %>%
    pivot_wider(names_from = phan_loan_roi_loan_nhan_thuc, values_from = "Giá trị") %>%
    mutate(
      `Test thần kinh` = label_nhanthuc[[var]],
      `Giá trị p` = if_else(`Chỉ số` == "Trung bình ± SD", formatted_p, "")
    ) %>%
    select(`Test thần kinh`, everything())

  return(df_stats)
}) %>%
  mutate(across(-`Test thần kinh`, ~str_replace_all(.x, "\\.", ",")))  # 🇻🇳 dấu phẩy Việt

# 📋 Bảng flextable
ft_nhanthuc_group <- flextable(table_nhanthuc_group %>% select(-`Giá trị p`))  %>%
  align(align = "center", part = "all") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  fontsize(size = 11, part = "all") %>%
  bold(i = 1, part = "header") %>%
  set_caption("Bảng: Mô tả và kiểm định các test thần kinh nhận thức theo nhóm nhận thức") %>%
  autofit()
# 💬 Inline mô tả bảng
# 📊 Biểu đồ density
df_long_nhanthuc <- df %>%
  select(phan_loan_roi_loan_nhan_thuc, all_of(tests_nhanthuc)) %>%
  pivot_longer(cols = -phan_loan_roi_loan_nhan_thuc, names_to = "test", values_to = "giatri") %>%
  mutate(test_label = fct_recode(factor(test), !!!label_nhanthuc))

plot_nhanthuc_group <- ggplot(df_long_nhanthuc, aes(x = giatri, fill = phan_loan_roi_loan_nhan_thuc)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~test_label, scales = "free", ncol = 3) +
  labs(
    x = "Giá trị", y = "Mật độ",
    fill = "Nhóm nhận thức",
    title = "Biểu đồ mật độ các test thần kinh theo nhóm nhận thức"
  ) +
  theme_minimal(base_family = "Times New Roman") +
  theme(
    strip.text = element_text(size = 11),
    axis.text = element_text(size = 10),
    axis.title = element_text(size = 11),
    plot.title = element_text(face = "bold", hjust = 0.5),
    legend.position = "bottom"
  )

# 💬 Inline mô tả bảng
inline_bang_tests_group <- glue(
  "Bảng trên  cho thấy nhiều test có sự khác biệt rõ rệt giữa nhóm Suy giảm nhận thức nhẹ và 'Sa sút trí tuệ', ",
  "với giá trị p < 0,05 được ghi nhận ở các test"
)

# 💬 Inline mô tả biểu đồ
inline_bieudo_tests_group <- glue(
  "Biểu đồ mật độ cho thấy sự phân tách giữa hai nhóm rõ nhất ở các test như 'Đọc số ngược', 'Nối số-chữ' và 'Vẽ đồng hồ', ",
  "gợi ý đây là các công cụ nhạy trong phân biệt mức độ suy giảm nhận thức."
)

# 💬 Inline bình luận tổng quan
inline_banluan_tests_group <- glue(
  "Kết quả kiểm định và biểu đồ đều cho thấy xu hướng rõ ràng: nhóm 'Sa sút trí tuệ' có hiệu suất thấp hơn đáng kể trên các test thần kinh nhận thức. ",
  "Điều này củng cố vai trò phân biệt của các công cụ đánh giá nhận thức ngắn gọn trong tầm soát suy giảm."
)
# 💬 Inline bàn luận tổng quan
inline_banluan_tests <- glue(
  "Nhìn chung, các test như 'Đọc số ngược', 'Nối số-chữ' có nhiều giá trị thấp, phản ánh mức suy giảm nhận thức ở bệnh nhân"
)

```

## Phân tích tương quan mmse theo nhóm chẩn đoán

### Tính tương quan theo nhóm (MCI và sa sút trí tuệ)

```{r}
# Hàm định dạng số kiểu Việt
format_vn <- function(x) {
  format(round(as.numeric(x), 2), decimal.mark = ",", nsmall = 2)
}

# Danh sách test và nhãn tiếng Việt
cor_vars <- c(
  "Im.recall1", "de.recall1", "de.reg1",
  "TMT.A.time", "TMT.B.time",
  "DS.forward1", "DS.backrward1",
  "animal.test1", "clock.drawing1"
)
cor_labels <- c(
  "Nhớ lại ngay", "Nhớ lại có trì hoãn", "Nhận biết có trì hoãn",
  "Nối số (TMT-A)", "Nối số - chữ (TMT-B)",
  "Đọc số xuôi", "Đọc số ngược",
  "Lưu loát ngôn ngữ", "Vẽ đồng hồ"
)
names(cor_labels) <- cor_vars

# Tính tương quan
cor_table <- purrr::map_dfr(cor_vars, function(var) {
  df_sub <- df %>% select(mmse.new, !!sym(var)) %>% drop_na()

  test <- tryCatch(
    cor.test(df_sub$mmse.new, df_sub[[var]], method = "spearman"),
    error = function(e) NULL
  )

  if (!is.null(test)) {
    r_val <- round(test$estimate, 2)
    abs_r <- abs(r_val)
    muc_do <- case_when(
      abs_r >= 0.7 ~ "Chặt",
      abs_r >= 0.5 ~ "Khá",
      abs_r >= 0.3 ~ "Vừa",
      TRUE         ~ "Yếu"
    )

    data.frame(
      Test.thần.kinh = cor_labels[[var]],
      Hệ.số.tương.quan..r. = r_val,
      Giá.trị.p = ifelse(test$p.value < 0.001, "< 0.001", sprintf("%.3f", test$p.value)),
      Mức.độ.tương.quan = muc_do
    )
  }
})
# Định dạng số kiểu Việt
format_vn <- function(x) {
  format(round(as.numeric(x), 2), decimal.mark = ",", nsmall = 2)
}

# Tính tương quan Spearman cho từng nhóm
cor_by_group <- purrr::map_dfr(
  .x = c("MCI", "Sa sút trí tuệ"),
  .f = function(gr) {
    purrr::map_dfr(cor_vars, function(var) {
      df_sub <- df %>%
        filter(phan_loan_roi_loan_nhan_thuc == gr) %>%
        select(mmse.new, !!sym(var)) %>% drop_na()

      test <- tryCatch(
        cor.test(df_sub$mmse.new, df_sub[[var]], method = "spearman"),
        error = function(e) NULL
      )

      if (!is.null(test)) {
        r_val <- round(test$estimate, 2)
        abs_r <- abs(r_val)
        muc_do <- case_when(
          abs_r >= 0.7 ~ "Chặt",
          abs_r >= 0.5 ~ "Khá",
          abs_r >= 0.3 ~ "Vừa",
          TRUE         ~ "Yếu"
        )

        data.frame(
          Nhóm = gr,
          Test.thần.kinh = cor_labels[[var]],
          Hệ.số.tương.quan.r = r_val,
          Giá.trị.p = ifelse(test$p.value < 0.001, "< 0.001", sprintf("%.3f", test$p.value)),
          Mức.độ.tương.quan = muc_do
        )
      }
    })
  }
)

mota_theo_nhom <- function(nhom, muc) {
  data <- cor_by_group %>%
    filter(Nhóm == nhom, Mức.độ.tương.quan == muc)

  if (nrow(data) == 0) return(NULL)

  data <- data %>%
    mutate(
      r_txt = format(round(Hệ.số.tương.quan.r, 2), decimal.mark = ","),
      p_txt = ifelse(
        Giá.trị.p == "< 0.001", "< 0,001",
        format(round(as.numeric(gsub("< ", "", Giá.trị.p)), 3), decimal.mark = ",")
      ),
      test_format = ifelse(
        as.numeric(gsub("< ", "", Giá.trị.p)) < 0.05,
        glue("**{Test.thần.kinh}** (r = {r_txt}, p = {p_txt})"),
        glue("{Test.thần.kinh} (r = {r_txt}, p = {p_txt})")
      )
    )

  glue("{nrow(data)} test của nhóm **{nhom}** có tương quan {tolower(muc)} với MMSE: {glue_collapse(data$test_format, sep = '; ', last = ' và ')}.")
}
```

### Bảng flextable tương quan theo nhóm

```{r}
ft_corr_grouped <- if (nrow(cor_by_group) > 0) {
  ft_corr_grouped <- flextable(cor_by_group) %>%
  colformat_num(j = "Hệ.số.tương.quan.r", decimal.mark = ",", big.mark = ".") %>%
  autofit() %>%
  bold(i = 1, part = "header") %>%
  set_header_labels(
    Nhóm = "Phân nhóm",
    Test.thần.kinh = "Test thần kinh nhận thức",
    Hệ.số.tương.quan.r = "Hệ số tương quan r",
    Giá.trị.p = "Giá trị p",
    Mức.độ.tương.quan = "Mức độ tương quan"
  ) %>%
  font(fontname = "Times New Roman", part = "all") %>%
  fontsize(size = 11, part = "all") %>%
    set_caption("Bảng: Tương quan giữa MMSE và các test nhận thức theo từng nhóm chẩn đoán") %>%
  set_table_properties(width = 1, layout = "autofit")
  ft_corr_grouped
} else {
  'Không có dữ liệu để hiển thị bảng tương quan theo nhóm.'
} %>%
  set_table_properties(width = 1, layout = "autofit")

ft_corr_grouped

# Chuẩn bị bảng long-format
cor_long <- cor_by_group %>%
  mutate(
    info = ifelse(
      Giá.trị.p == "< 0.001",
      glue("{format_vn(Hệ.số.tương.quan.r)} (p < 0,001)"),
      glue("{format_vn(Hệ.số.tương.quan.r)} (p = {format_vn(as.numeric(Giá.trị.p))})")
    )
  ) %>%
  select(Nhóm, Test.thần.kinh, info) %>%
  pivot_wider(names_from = Nhóm, values_from = info)

# Tạo bảng flextable dạng wide
ft_corr_long <- flextable(cor_long) %>%
  set_header_labels(
    Test.thần.kinh = "Test thần kinh nhận thức",
    `MCI` = "MCI (r, p)",
    `Sa sút trí tuệ` = "Sa sút trí tuệ (r, p)"
  ) %>%
  autofit() %>%
  font(fontname = "Times New Roman", part = "all") %>%
  fontsize(size = 11, part = "all") %>%
  set_caption("Bảng: Tương quan giữa MMSE và các test nhận thức theo nhóm chẩn đoán (dạng long)") %>%
  set_table_properties(width = 1, layout = "autofit")
```

### Biểu đồ ggplot theo nhóm

```{r}
df_plot_grouped <- cor_by_group %>%
  mutate(
    test_than_kinh = factor(Test.thần.kinh, levels = rev(unique(Test.thần.kinh))),
    co_y_nghia = ifelse(as.numeric(gsub("< ", "", Giá.trị.p)) < 0.05, "Có ý nghĩa", "Không ý nghĩa")
  )

plot_corr_grouped <- ggplot(df_plot_grouped, aes(x = test_than_kinh, y = Hệ.số.tương.quan.r, fill = co_y_nghia)) +
  geom_col(width = 0.6) +
  geom_text(
    aes(label = format_vn(Hệ.số.tương.quan.r)),
    hjust = ifelse(df_plot_grouped$Hệ.số.tương.quan.r >= 0, -0.1, 1.1),
    color = "black", size = 3.5, family = "Times New Roman"
  ) +
  facet_wrap(~Nhóm) +
  coord_flip(clip = "off") +
  scale_fill_brewer(palette = "Pastel1") +
  expand_limits(y = c(-1.05, 1.05)) +
  labs(
    title = "Tương quan giữa MMSE và các test nhận thức theo từng nhóm",
    x = NULL, y = "Hệ số tương quan (r)",
    fill = "Ý nghĩa thống kê"
  ) +
  theme_minimal(base_family = "Times New Roman") +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
    axis.text = element_text(size = 11),
    legend.position = "top"
  )

plot_corr_grouped
ft_corr_long
```

### Nhận xét riêng cho bảng và biểu đồ

-   Hàm tạo câu nhận xét theo nhóm và mức độ

```{r}
ota_theo_nhom <- function(nhom, muc) {
  data <- cor_by_group %>%
    filter(Nhóm == nhom, Mức.độ.tương.quan == muc)

  if (nrow(data) == 0) return(NULL)

  data <- data %>%
    mutate(
      r_txt = format_vn(Hệ.số.tương.quan.r),
      p_txt = ifelse(
        Giá.trị.p == "< 0.001", "< 0,001",
        format_vn(as.numeric(gsub("< ", "", Giá.trị.p)))
      ),
      test_format = ifelse(
        as.numeric(gsub("< ", "", Giá.trị.p)) < 0.05,
        glue("**{Test.thần.kinh}** (r = {r_txt}, p = {p_txt})"),
        glue("{Test.thần.kinh} (r = {r_txt}, p = {p_txt})")
      )
    )

  glue("{nrow(data)} test của nhóm **{nhom}** có tương quan {tolower(muc)} với MMSE: {glue_collapse(data$test_format, sep = '; ', last = ' và ')}.")
}
```

### Nhận xét riêng cho bảng flextable

```{r}
cau_bang_mci <- glue_collapse(purrr::compact(c(
  mota_theo_nhom("MCI", "Chặt"),
  mota_theo_nhom("MCI", "Khá"),
  mota_theo_nhom("MCI", "Vừa"),
  mota_theo_nhom("MCI", "Yếu")
)), sep = " ")

cau_bang_sstt <- glue_collapse(purrr::compact(c(
  mota_theo_nhom("Sa sút trí tuệ", "Chặt"),
  mota_theo_nhom("Sa sút trí tuệ", "Khá"),
  mota_theo_nhom("Sa sút trí tuệ", "Vừa"),
  mota_theo_nhom("Sa sút trí tuệ", "Yếu")
)), sep = " ")
```

-   Nhận xét tổng hợp cho biểu đồ ggplot

```{r}
cor_wide_compare <- cor_by_group %>%
  select(Nhóm, Test.thần.kinh, Hệ.số.tương.quan.r) %>%
  pivot_wider(names_from = Nhóm, values_from = Hệ.số.tương.quan.r)

test_tuong_quan_cao_hon_sstt <- cor_wide_compare %>%
  filter(`Sa sút trí tuệ` - MCI >= 0.1) %>%
  arrange(desc(`Sa sút trí tuệ` - MCI)) %>%
  pull(Test.thần.kinh)

if (length(test_tuong_quan_cao_hon_sstt) > 0) {
  test_nhanh <- glue_collapse(head(test_tuong_quan_cao_hon_sstt, 3), sep = ", ", last = " và ")
  cau_inline_so_sanh_sstt_mci <- glue("Một số test như {test_nhanh} có tương quan mạnh hơn ở nhóm sa sút trí tuệ.")
} else {
  cau_inline_so_sanh_sstt_mci <- "Không có test nào có tương quan mạnh hơn rõ rệt giữa hai nhóm."
}
```

### Inline gọi kết quả trong tài liệu

#### Nhận xét từ bảng tương quan:

-   **Nhóm MCI**: `r cau_bang_mci`\
-   **Nhóm Sa sút trí tuệ**: `r cau_bang_sstt`

#### Nhận xét từ biểu đồ tương quan:

`r cau_inline_so_sanh_sstt_mci`

## Mức độ hoàn thành các test thần kinh nhận thức

```{r}
#| label: mức độ hoàn thành các tests
# 🧠 Danh sách các biến test thần kinh nhận thức
neuro_vars <- c(
  "Im.recall1", "de.recall1", "de.reg1",
  "TMT.A.time", "TMT.B.time",
  "DS.forward1", "DS.backrward1",
  "animal.test1", "clock.drawing1"
)

# 📝 Nhãn tiếng Việt tương ứng
test_labels_map <- c(
  "Im.recall1" = "Nhớ lại ngay",
  "de.recall1" = "Nhớ lại có trì hoãn",
  "de.reg1" = "Nhận biết có trì hoãn",
  "TMT.A.time" = "Nối số",
  "TMT.B.time" = "Nối số-chữ",
  "DS.forward1" = "Đọc chuỗi số xuôi",
  "DS.backrward1" = "Đọc chuỗi số ngược",
  "animal.test1" = "Lưu loát ngôn ngữ",
  "clock.drawing1" = "Vẽ đồng hồ"
)

# ✨ Thứ tự mong muốn để hiển thị nhất quán
label_order <- c(
  "Nhớ lại ngay", "Nhớ lại có trì hoãn", "Nhận biết có trì hoãn",
  "Nối số", "Nối số-chữ",
  "Đọc chuỗi số xuôi", "Đọc chuỗi số ngược",
  "Lưu loát ngôn ngữ", "Vẽ đồng hồ"
)

# 📊 Tính toán tỉ lệ hoàn thành theo nhóm
completion_summary <- purrr::map_dfr(neuro_vars, function(var) {
  df %>%
    group_by(phan_loan_roi_loan_nhan_thuc) %>%
    summarise(
      Biến = var,
      Hoàn.thành = round(100 * sum(!is.na(.data[[var]])) / n(), 1),
      .groups = "drop"
    )
})

# 📋 Tạo bảng flextable
completion_wide <- completion_summary %>%
  select(Nhóm = phan_loan_roi_loan_nhan_thuc, Biến, Hoàn.thành) %>%
  pivot_wider(names_from = Nhóm, values_from = Hoàn.thành) %>%
  mutate(`Test thần kinh` = factor(test_labels_map[Biến], levels = label_order)) %>%
  arrange(`Test thần kinh`) %>%
  select(`Test thần kinh`, `MCI`, `Sa sút trí tuệ`)

ft_hoanthanh <- flextable(completion_wide) %>%
  set_header_labels(
    `Test thần kinh` = "Test thần kinh nhận thức",
    `MCI` = "MCI (%)",
    `Sa sút trí tuệ` = "Sa sút trí tuệ (%)"
  ) %>%
  colformat_num(decimal.mark = ",", suffix = "%") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  fontsize(size = 11, part = "all") %>%
  autofit() %>%
  #set_caption("Bảng: Tỉ lệ hoàn thành các test thần kinh nhận thức theo nhóm chẩn đoán") %>%
  set_table_properties(width = 1, layout = "autofit")

# 📊 Chuẩn bị và vẽ biểu đồ ggplot theo đúng thứ tự
label_order <- c(
  "Nhớ lại ngay", "Nhớ lại có trì hoãn", "Nhận biết có trì hoãn",
  "Nối số", "Nối số-chữ",
  "Đọc chuỗi số xuôi", "Đọc chuỗi số ngược",
  "Lưu loát ngôn ngữ", "Vẽ đồng hồ"
)

plot_hoanthanh <- completion_summary %>%
  mutate(
    Nhóm = factor(phan_loan_roi_loan_nhan_thuc, levels = c("MCI", "Sa sút trí tuệ")),
    Nhãn = factor(test_labels_map[Biến], levels = rev(label_order))
  ) %>%
  ggplot(aes(x = Nhãn, y = Hoàn.thành, fill = Nhóm)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_text(
    aes(label = paste0(Hoàn.thành, "%")),
    position = position_dodge(width = 0.8),
    hjust = -0.5,  # 👈 Nhãn nằm bên phải ngoài cột
    size = 3.5,
    family = "Times New Roman"
  ) +
  coord_flip(clip = "off") +
  scale_x_discrete(expand = expansion(mult = c(0.2, 0.2))) +
  scale_fill_brewer(palette = "Pastel2") +
  expand_limits(y = max(completion_summary$Hoàn.thành) + 15) +  # 👈 Thêm khoảng trống cho nhãn
  labs(
   # title = "Tỉ lệ hoàn thành các test thần kinh nhận thức",
    x = NULL, y = "Tỉ lệ hoàn thành (%)", fill = "Nhóm"
  ) +
  theme_minimal(base_family = "Times New Roman") +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 13),
    axis.text = element_text(size = 10),
    legend.position = "top"
  )

# ✏️ Nhận xét tự động
nhom_thap_mci <- completion_summary %>%
  filter(phan_loan_roi_loan_nhan_thuc == "MCI") %>%
  arrange(Hoàn.thành) %>%
  slice(1)

nhom_thap_sstt <- completion_summary %>%
  filter(phan_loan_roi_loan_nhan_thuc == "Sa sút trí tuệ") %>%
  arrange(Hoàn.thành) %>%
  slice(1)

cau_hoanthanh_bang <- glue(
  "Tỉ lệ hoàn thành nhìn chung cao, từ khoảng ",
  "{min(completion_summary$Hoàn.thành)}% đến {max(completion_summary$Hoàn.thành)}%. ",
  "Test {test_labels_map[nhom_thap_mci$Biến]} thấp nhất ở nhóm MCI ({nhom_thap_mci$Hoàn.thành}%), ",
  "và test {test_labels_map[nhom_thap_sstt$Biến]} thấp nhất ở nhóm sa sút trí tuệ ({nhom_thap_sstt$Hoàn.thành}%)."
)

cau_hoanthanh_ggplot <- glue(
  "Biểu đồ cho thấy phần lớn test được thực hiện với tỉ lệ cao trong cả hai nhóm, ",
  "chỉ có một số test gặp khó khăn hơn ở nhóm MCI hoặc sa sút trí tuệ."
)
```

```{r}
ft_hoanthanh
```

```{r}
plot_hoanthanh
```

### Nhận xét từ bảng:

`r cau_hoanthanh_bang`

### Nhận xét từ biểu đồ:

`r cau_hoanthanh_ggplot`

## Đánh giá sự tương đồng giữa phân độ MMSE và phân loại lâm sàng theo tiêu chuẩn lâm sàng

Tiêu chuẩn lâm sàng (biến lam_sang_group) và tiêu chuẩn phân độ MMSE (nhóm lam_sang_group)đối với các mức độ "Suy giảm nhận thức nhẹ", "Sa sút trí tuệ nhẹ","Sa sút trí tuệ trung bình","Sa sút trí tuệ nặng"

```{r}
# 📦 Chuẩn bị dữ liệu và mã hóa thứ bậc
df_ord <- df %>%
  filter(
    !is.na(mmse_group),
    !is.na(lam_sang_group),
    mmse_group != "Bình thường"  # ❌ Loại bỏ nhóm Bình thường
  ) %>%
  mutate(
    mmse_group = droplevels(mmse_group),
    lam_sang_group = droplevels(lam_sang_group),
    mmse_num = as.numeric(mmse_group),
    lam_sang_num = as.numeric(lam_sang_group)
  )

# 📈 Kiểm định Spearman và Kendall
test_spearman <- cor.test(df_ord$mmse_num, df_ord$lam_sang_num, method = "spearman")
test_kendall  <- cor.test(df_ord$mmse_num, df_ord$lam_sang_num, method = "kendall")

rho <- round(test_spearman$estimate, 2)
pval_s <- test_spearman$p.value
pval_s_fmt <- ifelse(pval_s < 0.001, "< 0.001", sprintf("%.3f", pval_s))

tau <- round(test_kendall$estimate, 2)
pval_k <- test_kendall$p.value
pval_k_fmt <- ifelse(pval_k < 0.001, "< 0.001", sprintf("%.3f", pval_k))

# 🧾 Tạo bảng tần suất dạng chéo
tab_ordinal_long <- df_ord %>%
  count(`Phân loại lâm sàng` = lam_sang_group, `Phân độ MMSE` = mmse_group) %>%
  group_by(`Phân loại lâm sàng`) %>%
  mutate(
    Tỷ_lệ = round(100 * n / sum(n), 1),
    Tần_suất = glue("{n} ({Tỷ_lệ}%)")
  ) %>%
  select(-n, -Tỷ_lệ) %>%
  pivot_wider(names_from = `Phân độ MMSE`, values_from = Tần_suất, values_fill = "-") %>%
  mutate(
    `Giá trị p` = c(pval_s_fmt, rep("", n() - 1)),
    `Spearman ρ` = c(rho, rep("", n() - 1)),
    `Kendall τ` = c(tau, rep("", n() - 1))
  )

# 📊 Bảng flextable
ft_ord <- flextable(tab_ordinal_long) %>%
  set_caption("Bảng: Phân bố chéo giữa phân độ MMSE và phân loại lâm sàng (loại BT)") %>%
  autofit() %>%
  font(fontname = "Times New Roman", part = "all") %>%
  fontsize(size = 11, part = "all") %>%
  align(align = "center", part = "all")

# 🎨 Nhãn rút gọn
short_labels <- c(
  "Suy giảm nhận thức nhẹ" = "SGNT nhẹ",
  "Sa sút trí tuệ nhẹ" = "SSTT nhẹ",
  "Sa sút trí tuệ trung bình" = "SSTT TB",
  "Sa sút trí tuệ nặng" = "SSTT nặng"
)

# 🌡️ Heatmap với màu pastel
df_heatmap <- df_ord %>%
  count(lam_sang_group, mmse_group)

plot_heat <- ggplot(df_heatmap, aes(x = mmse_group, y = lam_sang_group, fill = n)) +
  geom_tile(color = "white") +
  geom_text(aes(label = n), color = "black", size = 4) +
  scale_fill_gradient(low = "#a8edea", high = "#fed6e3") +
  scale_x_discrete(labels = short_labels[levels(df_ord$mmse_group)]) +
  scale_y_discrete(labels = short_labels[levels(df_ord$lam_sang_group)]) +
  labs(x = "Phân độ theo MMSE", y = "Phân độ theo tiêu chuẩn lâm sàng", fill = "Tần suất") +
  theme_minimal(base_family = "Times New Roman") +
  theme(axis.text = element_text(size = 11), panel.grid = element_blank())

# 🔵 Scatter ordinal pastel
plot_scatter <- ggplot(df_ord, aes(x = mmse_num, y = lam_sang_num)) +
  geom_jitter(width = 0.2, height = 0.2, alpha = 0.6, color = "#40E0D0") +  # xanh ngọc
  geom_smooth(method = "lm", se = FALSE, color = "#FF6F61", linetype = "dashed") +  # cam đào
  scale_x_continuous(
    breaks = seq_along(levels(df_ord$mmse_group)),
    labels = short_labels[levels(df_ord$mmse_group)]
  ) +
  scale_y_continuous(
    breaks = seq_along(levels(df_ord$lam_sang_group)),
    labels = short_labels[levels(df_ord$lam_sang_group)]
  ) +
  labs(x = "Phân độ MMSE", y = "Phân loại lâm sàng") +
  theme_minimal(base_family = "Times New Roman") +
  theme(axis.text = element_text(size = 11), panel.grid = element_blank())

# 📝 Inline codes mô tả
cau_chen_bieu_do_heatmap <- glue(
  "Biểu đồ thể hiện sư phân bố chéo cho thấy mối liên hệ giữa phân độ giai đoạn bệnh theo tiêu chuẩn MMSE và phân độ theo tiêu chuẩn lâm sàng, hay còn gọi tiêu chuẩn vàng. Biểu đồ cho thấy hệ số Spearman ρ = {rho}, Kendall τ = {tau}, với p = {pval_s_fmt}. ",
  if (pval_s < 0.05) "Kết quả có ý nghĩa thống kê." else "Kết quả không có ý nghĩa thống kê."
)

cau_bieudo_ordinal <- glue(
  "Biểu đồ minh họa phân bố tập trung ở các mức độ tương ứng, ",
  "cho thấy xu hướng đồng biến giữa phân độ giai đoạn bệnh theo tiêu chuẩn MMSE và phân độ theo tiêu chuẩn lâm sàng."
)

cau_chen_bieu_do_gop_2_loai  <- glue(
  "Biểu đồ bên trái  thể hiện sư phân bố chéo cho thấy mối liên hệ giữa phân độ giai đoạn bệnh theo tiêu chuẩn MMSE và phân độ theo tiêu chuẩn lâm sàng, hay còn gọi tiêu chuẩn vàng. Biểu đồ cho thấy hệ số Spearman ρ = {rho}, Kendall τ = {tau}, với p = {pval_s_fmt}. ",
  if (pval_s < 0.05) "Kết quả có ý nghĩa thống kê." else "Kết quả không có ý nghĩa thống kê. ",  "Biểu đồ bên phải minh họa phân bố tập trung ở các mức độ tương ứng, ", "cho thấy xu hướng đồng biến giữa phân độ giai đoạn bệnh theo tiêu chuẩn MMSE và phân độ theo tiêu chuẩn lâm sàng."
)
```

#### gộp 2 biểu đồ

```{r}
#| label: plot_heat_scatter_ordinal
#| fig-cap: "Biểu đồ heatmap và scatter ordinal thể hiện mối liên hệ giữa phân độ MMSE và giai đoạn lâm sàng"
#| echo: true
#| message: false
#| warning: false
#| fig-align: center
#| out.width: "100%"

pacman::p_load(patchwork)  # 📦 Ghép biểu đồ

# 🌈 Nhãn rút gọn
short_labels <- c(
  "Suy giảm nhận thức nhẹ" = "SGNT nhẹ",
  "Sa sút trí tuệ nhẹ" = "SSTT nhẹ",
  "Sa sút trí tuệ trung bình" = "SSTT TB",
  "Sa sút trí tuệ nặng" = "SSTT nặng"
)

# 🌡️ Heatmap pastel
df_heatmap <- df_ord %>%
  count(lam_sang_group, mmse_group)

plot_heat <- ggplot(df_heatmap, aes(x = mmse_group, y = lam_sang_group, fill = n)) +
  geom_tile(color = "white") +
  geom_text(aes(label = n), color = "black", size = 4) +
  scale_fill_gradient(low = "#a8edea", high = "#fed6e3") +  # pastel xanh-hồng
  scale_x_discrete(labels = short_labels[levels(df_ord$mmse_group)]) +
  scale_y_discrete(labels = short_labels[levels(df_ord$lam_sang_group)]) +
  labs(x = "Phân độ theo MMSE", y = "Phân độ trên lâm sàng", fill = "Tần suất") +
  theme_minimal(base_family = "Times New Roman") +
  theme(
   axis.text = element_text(size = 11),
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid = element_blank()
  )

# 🔵 Scatter ordinal pastel
plot_scatter <- ggplot(df_ord, aes(x = mmse_num, y = lam_sang_num)) +
  geom_jitter(width = 0.2, height = 0.2, alpha = 0.6, color = "#40E0D0") +  # turquoise
  geom_smooth(method = "lm", se = FALSE, color = "#FF6F61", linetype = "dashed") +  # coral
  scale_x_continuous(
    breaks = seq_along(levels(df_ord$mmse_group)),
    labels = short_labels[levels(df_ord$mmse_group)]
  ) +
  scale_y_continuous(
    breaks = seq_along(levels(df_ord$lam_sang_group)),
    labels = short_labels[levels(df_ord$lam_sang_group)]
  ) +
  labs(x = "Phân độ theo MMSE", y = "Phân độ trên lâm sàng") +
  theme_minimal(base_family = "Times New Roman") +
  theme(
   axis.text = element_text(size = 11),
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid = element_blank()
  )


```

#### gộp chung để chèn powerpoint

```{r}
# 🌈 Nhãn rút gọn
short_labels <- c(
  "Suy giảm nhận thức nhẹ" = "SGNT nhẹ",
  "Sa sút trí tuệ nhẹ" = "SSTT nhẹ",
  "Sa sút trí tuệ trung bình" = "SSTT TB",
  "Sa sút trí tuệ nặng" = "SSTT nặng"
)

# 🌡️ Heatmap pastel
df_heatmap <- df_ord %>%
  count(lam_sang_group, mmse_group)

plot_heat <- ggplot(df_heatmap, aes(x = mmse_group, y = lam_sang_group, fill = n)) +
  geom_tile(color = "white") +
  geom_text(aes(label = n), color = "black", size = 4) +
  scale_fill_gradient(low = "#a8edea", high = "#fed6e3") +  # pastel xanh-hồng
  scale_x_discrete(labels = short_labels[levels(df_ord$mmse_group)]) +
  scale_y_discrete(labels = short_labels[levels(df_ord$lam_sang_group)]) +
  labs(x = "Phân độ MMSE", y = "Phân loại lâm sàng", fill = "Tần suất") +
  theme_minimal(base_family = "Times New Roman") +  # ✅ hoàn chỉnh font
  theme(
    axis.text = element_text(size = 11),
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid = element_blank()
  )
```

#### Bảng flextable (chưa cần chèn )

```{r}
#| eval: false
#| include: false
ft_ord
```

#### biểu đồ gộp

```{r}
plot_heat + plot_scatter + plot_layout(ncol = 2)
```

##### `r cau_chen_bieu_do_gop_2_loai`

#### Biểu đồ heatmap

```{r}
plot_heat
```

##### `r cau_chen_bieu_do_heatmap`

#### Biểu đồ scatter về sự phù hợp

```{r}
plot_scatter
```

##### `r cau_bieudo_ordinal`

::: {custom-style="CAN GIUA DAM 14 ONE"}
ĐẶT VẤN ĐỀ
:::

Việt Nam là một trong các quốc gia có tốc độ già hóa dân số nhanh nhất thế giới. Người ta ước tính rằng hơn 10% dân số Việt Nam bao gồm những người từ 60 tuổi trở lên, từ năm 2015 đến năm 2020[@nguyen2024nhan_thuc], tỷ lệ dân số trên 65 tuổi ở Việt Nam tăng từ 6,7% lên 7,9% và sẽ tiếp tục cho thấy xu hướng tăng đến năm 2050 [@nguyen2021share]. Tỷ lệ dân số từ 60 tuổi trở lên dự kiến sẽ chiếm 20,4% tổng dân số Việt Nam vào năm 20383. Dựa trên các xu hướng nhân khẩu học này, dự kiến đến năm 2050, sẽ có 29 triệu người trên 60 tuổi, chiếm một phần ba dân số cả nước, trong đó những người trên 80 tuổi dự kiến sẽ chiếm ít nhất 6% toàn bộ dân số [@helpage2019vietnam].

Cùng với việc già hóa dân số, tỉ lệ người sa sút trí tuệ cũng tăng lên, số người mắc chứng sa sút trí tuệ ước tính tăng gấp đôi sau mỗi 20 năm, từ 660.000 vào năm 2015 lên 1,2 triệu vào năm 2030 và 2,4 triệu vào năm 2050[@nguyen2020dementia]. Sa sút trí tuệ (SSTT) là một bệnh lý của não bộ, gây ra suy giảm chức năng nhận thức, hành vi và hoạt động sống của bệnh nhân. Sa sút trí tuệ là thuật ngữ rộng dùng để mô tả tình trạng mất trí nhớ, nhận thức, lý trí, kỹ năng xã hội và thể chất.

Có nhiều loại sa sút trí tuệ bao gồm bệnh Alzheimer, sa sút trí tuệ mạch máu, sa sút trí tuệ trán thái dương và bệnh thể Lewy. Sa sút trí tuệ có thể xảy ra với bất kỳ ai, nhưng phổ biến hơn sau tuổi 65[@aihw2022dementia].

Từ năm 2019 đến nay, Đơn vị Trí nhớ và Sa sút trí tuệ Bệnh viện 30-4 đã sử dụng bộ trắc nghiệm (Test) đánh giá chức năng thần kinh nhận thức Việt Nam (VnCA- Vietnamese Cognitive Assessment), Hội bệnh Alzheimer và Rối loạn thần kinh nhận thức Việt Nam (Vietnam Alzheimer Disease & Neurocognitive Disorders Association – VnADA), chuyên gia Trung tâm Bệnh thoái hóa thần kinh Đức (DZNE), Đơn vị Trí nhớ và Sa sút trí tuệ Bệnh viện 30-4 cùng phát triển.

**Mục tiêu nghiên cứu của nhiệm vụ**

-   Nghiên cứu mối tương quan của thang điểm MMSE với các test thần kinh nhận thức khác trong bộ Test thần kinh nhận thức tại Bệnh viện 30-4.

-   Đánh giá hiệu quả ứng dụng của bộ Test thần kinh nhận thức trong chẩn đoán và điều trị Sa sút trí tuệ tại Bệnh viện 30-4

# TỔNG QUANG TÀI LIỆU

## Tổng quan về suy giảm nhận thức nhẹ và sa sút trí tuệ

Suy giảm nhận thức nhẹ (Mild Cognitive Impairment – MCI) và sa sút trí tuệ (dementia) là hai tình trạng phổ biến ở người cao tuổi, biểu hiện qua sự suy giảm chức năng nhận thức ở các mức độ khác nhau. MCI được xem là giai đoạn chuyển tiếp giữa quá trình lão hóa bình thường và sa sút trí tuệ, đặc trưng bởi sự suy giảm một hoặc nhiều lĩnh vực nhận thức nhưng chưa ảnh hưởng rõ rệt đến hoạt động sống hàng ngày. Ngược lại, sa sút trí tuệ là hội chứng tiến triển mạn tính, trong đó sự suy giảm nhận thức đủ mức độ để ảnh hưởng nghiêm trọng đến khả năng tự chăm sóc, nghề nghiệp và chức năng xã hội của người bệnh @Petersen2014.

### Dịch tễ học

Theo Tổ chức Y tế Thế giới (WHO), tính đến năm 2023, có khoảng 55 triệu người đang sống chung với sa sút trí tuệ trên toàn cầu, với khoảng 10 triệu ca mắc mới mỗi năm. Con số này được dự báo sẽ tăng lên 139 triệu người vào năm 2050 do tốc độ già hóa dân số @WHO2023. Sa sút trí tuệ hiện là nguyên nhân đứng thứ 7 gây tử vong toàn cầu và là nguyên nhân hàng đầu gây phụ thuộc ở người cao tuổi.

Tại Việt Nam, các nghiên cứu cho thấy tỷ lệ sa sút trí tuệ ở người ≥60 tuổi dao động từ 4% đến 8%, trong khi MCI chiếm khoảng 10–20% ở nhóm người cao tuổi @Nguyen2020. Việt Nam hiện có hơn 12 triệu người từ 60 tuổi trở lên, con số này dự kiến sẽ vượt 20 triệu vào năm 2039, làm gia tăng gánh nặng về các bệnh lý nhận thức. Tình trạng này đặc biệt đáng quan ngại ở các vùng nông thôn và miền núi, nơi thiếu hụt nguồn lực y tế và đội ngũ chuyên ngành lão khoa.

### Cơ chế bệnh sinh

Cơ chế bệnh sinh của MCI và sa sút trí tuệ rất phức tạp, liên quan đến nhiều yếu tố thần kinh, mạch máu, chuyển hóa và di truyền. Ở bệnh Alzheimer – nguyên nhân phổ biến nhất – sự tích tụ của mảng β-amyloid và đám rối sợi tau trong não gây tổn thương synap và chết tế bào thần kinh @Selkoe2012. Các thay đổi này bắt đầu âm thầm từ nhiều năm trước khi biểu hiện lâm sàng xuất hiện, thường khởi phát từ vùng hải mã (hippocampus) – trung tâm ghi nhớ của não – và lan dần ra vỏ não.

Ngoài ra, tổn thương vi mạch não và thiếu máu não mạn tính cũng đóng vai trò quan trọng trong bệnh sinh của sa sút trí tuệ mạch máu. Các yếu tố nguy cơ như tăng huyết áp, đái tháo đường, rối loạn lipid máu và hút thuốc lá làm suy giảm tính toàn vẹn của hàng rào máu–não, dẫn đến vi nhồi máu não nhiều ổ nhỏ (lacunar infarcts) và tổn thương chất trắng. Yếu tố viêm thần kinh, stress oxy hóa, rối loạn chuyển hóa glucose ở não, mất cân bằng chất dẫn truyền thần kinh (đặc biệt là acetylcholine và glutamate), cũng góp phần vào tiến trình thoái hóa thần kinh @Cummings2019.

Về mặt di truyền, sự mang gen APOE ε4 là yếu tố nguy cơ cao đối với bệnh Alzheimer khởi phát muộn. Tuy nhiên, không phải tất cả những người mang gen này đều phát triển bệnh, cho thấy vai trò của môi trường sống, lối sống và khả năng dự trữ nhận thức trong việc điều hòa nguy cơ.

### Các thể lâm sàng của sa sút trí tuệ

Sa sút trí tuệ bao gồm nhiều thể bệnh khác nhau, với đặc điểm bệnh sinh và lâm sàng riêng biệt:

-   **Sa sút trí tuệ do Alzheimer (Alzheimer's disease dementia)**: là thể phổ biến nhất, chiếm khoảng 60–70% tổng số ca. Đặc trưng bởi suy giảm trí nhớ gần là triệu chứng khởi phát, sau đó lan sang các chức năng nhận thức khác như ngôn ngữ, điều hành và định hướng. Bệnh tiến triển chậm nhưng liên tục qua các giai đoạn từ nhẹ đến nặng.

-   **Sa sút trí tuệ mạch máu (vascular dementia)**: chiếm khoảng 15–20% và thường gặp ở người có tiền sử đột quỵ hoặc yếu tố nguy cơ tim mạch. Bệnh có thể khởi phát đột ngột sau một biến cố mạch máu não, hoặc tiến triển theo kiểu bậc thang. Triệu chứng điển hình gồm rối loạn chú ý, chậm chạp tâm thần vận động, rối loạn chức năng điều hành và cảm xúc không ổn định.

-   **Sa sút trí tuệ thể Lewy (Dementia with Lewy bodies)**: đặc trưng bởi dao động nhận thức theo ngày, ảo giác thị giác sống động, rối loạn giấc ngủ REM và dấu hiệu ngoại tháp giống Parkinson. Nhạy cảm với thuốc chống loạn thần là dấu hiệu quan trọng giúp gợi ý chẩn đoán.

-   **Sa sút trí tuệ do Parkinson (Parkinson’s disease dementia)**: thường xuất hiện ở giai đoạn muộn của bệnh Parkinson, khi triệu chứng vận động đã tồn tại ít nhất 1 năm. Bệnh nhân thường biểu hiện chậm tư duy, suy giảm chức năng điều hành, khó khăn trong chuyển đổi chú ý và giảm trí nhớ làm việc.

### Triệu chứng lâm sàng

Ở giai đoạn MCI, bệnh nhân có thể biểu hiện suy giảm trí nhớ gần, khó ghi nhớ các cuộc hẹn hoặc thông tin vừa học. Ngoài ra, có thể có biểu hiện giảm khả năng tập trung, giảm hiệu quả trong các hoạt động đòi hỏi xử lý thông tin như quản lý tài chính hoặc lập kế hoạch. Tuy nhiên, khả năng tự chăm sóc vẫn còn nguyên vẹn hoặc chỉ suy giảm rất nhẹ.

Ngược lại, sa sút trí tuệ biểu hiện bằng suy giảm rõ rệt ở nhiều lĩnh vực nhận thức như trí nhớ, chú ý, ngôn ngữ, chức năng điều hành và nhận thức thị giác – không gian. Triệu chứng bao gồm: hay lặp câu, quên tên người quen, mất định hướng thời gian – không gian, khó khăn trong sử dụng từ ngữ hoặc theo dõi câu chuyện, lạc đường ngay cả ở nơi quen thuộc, thay đổi tính cách, và rối loạn hành vi như lo âu, kích động hoặc trầm cảm. Ở giai đoạn nặng, bệnh nhân mất hoàn toàn khả năng tự chăm sóc và phụ thuộc hoàn toàn vào người thân.

### Chẩn đoán phân biệt

Việc chẩn đoán cần phân biệt với các tình trạng như:

-   **Trầm cảm nặng**: có thể gây ra "sa sút trí tuệ giả" với biểu hiện than phiền trí nhớ kém, nhưng thường hồi phục khi điều trị trầm cảm.

-   **Thiếu hụt vitamin B12, suy giáp, rối loạn điện giải**: có thể gây ra triệu chứng tương tự nhưng cải thiện sau khi điều trị nguyên nhân.

-   **Sảng (delirium)**: thường khởi phát cấp tính, dao động về mức độ tỉnh táo, thường có yếu tố khởi phát rõ (nhiễm trùng, thuốc).

-   **Rối loạn tâm thần phân liệt, rối loạn lo âu mạn tính**: có thể ảnh hưởng đến nhận thức nhưng không có tiến triển mạn tính như sa sút trí tuệ.

Chẩn đoán chính xác cần dựa vào khai thác bệnh sử, thăm khám thần kinh, các công cụ sàng lọc như MMSE, cùng với hình ảnh học thần kinh (CT, MRI) và xét nghiệm sinh hóa.

### Diễn tiến lâm sàng

MCI có diễn tiến đa dạng: một số trường hợp có thể ổn định nhiều năm, một số có thể phục hồi nếu nguyên nhân là thứ phát (như stress, thiếu B12), nhưng một tỉ lệ lớn sẽ tiến triển thành sa sút trí tuệ. Các nghiên cứu cho thấy khoảng 10–15% người MCI chuyển sang sa sút trí tuệ mỗi năm @Petersen2014.

Sa sút trí tuệ là tình trạng không hồi phục và tiến triển dần theo thời gian. Bệnh thường trải qua 3 giai đoạn:

-   **Giai đoạn nhẹ**: quên gần, giảm chú ý, rối loạn định hướng nhẹ

-   **Giai đoạn trung bình**: giảm khả năng tự chăm sóc, lặp từ, mất khả năng giải quyết vấn đề, lạc đường

-   **Giai đoạn nặng**: mất khả năng ngôn ngữ, liệt giường, phụ thuộc hoàn toàn, biến chứng nhiễm trùng, suy kiệt

Thời gian sống trung bình từ lúc chẩn đoán đến tử vong dao động 6–10 năm, phụ thuộc thể bệnh, tuổi khởi phát, bệnh kèm và chăm sóc xã hội.

### Điều trị và chăm sóc hỗ trợ

Việc điều trị sa sút trí tuệ hiện nay chủ yếu mang tính chất triệu chứng và hỗ trợ, vì hầu hết các thể bệnh đều không có phương pháp chữa khỏi hoàn toàn. Mục tiêu điều trị bao gồm làm chậm tiến triển bệnh, kiểm soát triệu chứng hành vi, cải thiện chất lượng sống và hỗ trợ người chăm sóc.

#### 1. Điều trị bằng thuốc

-   **Chất ức chế cholinesterase** (donepezil, rivastigmine, galantamine): thường được sử dụng trong sa sút trí tuệ do Alzheimer hoặc thể Lewy. Các thuốc này giúp cải thiện triệu chứng nhận thức và hành vi ở mức độ nhẹ đến trung bình.

-   **Memantine**: chất đối kháng NMDA, có thể dùng đơn độc hoặc phối hợp với thuốc cholinesterase trong giai đoạn trung bình đến nặng.

-   **Thuốc kiểm soát hành vi**: bao gồm thuốc chống loạn thần (risperidone, quetiapine), thuốc chống trầm cảm (SSRIs), thuốc an thần nhẹ, nhưng cần sử dụng thận trọng vì nguy cơ tác dụng phụ ở người cao tuổi.

#### 2. Điều trị không dùng thuốc

-   **Trị liệu nhận thức** (cognitive stimulation therapy): gồm các hoạt động như luyện trí nhớ, trò chuyện nhóm, bài tập tư duy logic.

-   **Can thiệp hoạt động chức năng**: hỗ trợ bệnh nhân giữ được khả năng tự chăm sóc càng lâu càng tốt thông qua phục hồi chức năng, hướng dẫn kỹ năng sinh hoạt.

-   **Giáo dục và hỗ trợ người chăm sóc**: giúp giảm gánh nặng tâm lý và nâng cao hiệu quả chăm sóc dài hạn.

#### 3. Chăm sóc dài hạn

-   **Thiết kế môi trường an toàn**: tránh nguy cơ té ngã, lạc đường; tạo không gian quen thuộc, yên tĩnh, dễ định hướng.

-   **Hỗ trợ dinh dưỡng và vận động**: duy trì thể trạng, tránh suy kiệt và biến chứng do nằm lâu.

-   **Hỗ trợ giai đoạn cuối**: chăm sóc giảm nhẹ, điều trị triệu chứng, chuẩn bị tâm lý cho người thân.

Mỗi thể lâm sàng có thể đáp ứng điều trị khác nhau. Ví dụ, bệnh nhân thể Lewy rất nhạy cảm với thuốc chống loạn thần, cần tránh dùng haloperidol. Trong khi đó, sa sút trí tuệ mạch máu cần kiểm soát chặt các yếu tố nguy cơ tim mạch để làm chậm tiến triển bệnh.

### Tiêu chuẩn chẩn đoán theo DSM-5

Theo DSM-5 @DSM5, rối loạn nhận thức được chia thành:

-   **Rối loạn nhận thức nhẹ (Mild Neurocognitive Disorder)**: có bằng chứng về suy giảm nhẹ một hoặc nhiều lĩnh vực nhận thức (qua người thân hoặc test chuẩn hóa); không ảnh hưởng rõ rệt đến sinh hoạt hàng ngày; người bệnh có thể cần nỗ lực bù trừ.

-   **Rối loạn nhận thức nặng (Major Neurocognitive Disorder)**: suy giảm rõ rệt, ảnh hưởng đến sinh hoạt độc lập, cần hỗ trợ trong hoạt động hàng ngày.

Chẩn đoán cần loại trừ nguyên nhân khác như sảng, trầm cảm nặng, và cần xác định nguyên nhân nền nếu có thể (Alzheimer, mạch máu, thể hỗn hợp...).

## Giới thiệu về bộ trắc nghiệm thần kinh nhận thức

```{r}
#| label: Bảng các trắc nghiệm
#| message: false
#| warning: false
#| include: false
#| paged-print: false
# Dữ liệu bảng trắc nghiệm đã chuẩn hóa
bo_test_vnca <- tibble::tibble(
  STT = c(1, 2, 3, 3, 4, 4, 5, 5, 6, 7),
  Linh_vuc = c(
    "Sàng lọc chung sa sút trí tuệ (Global Dementia Screening)",
    "Nhớ từ (Verbal Memory)",
    rep("Tốc độ vận động thị giác (Visuomotor Speed)", 2),
    rep("Nhớ từ (Verbal Memory)", 2),
    rep("Sự chú ý (Attention)", 2),
    "Ngôn ngữ (Language)",
    "Xây dựng hình ảnh qua thị giác (Visuoconstruction)"
  ),
  Trac_nghiem = c(
    "MMSE – Đánh giá trạng thái tâm thần tối thiểu",
    "Nhớ danh sách từ (Word List Recall)",
    "Trail Making Test A (TMT-A)",
    "Trail Making Test B (TMT-B)",
    "Nhớ lại có trì hoãn (Delayed Recall)",
    "Nhận biết có trì hoãn (Delayed Recognition)",
    "Đọc xuôi dãy số (Digit Span Forward)",
    "Đọc ngược dãy số (Digit Span Backward)",
    "Nói lưu loát từ về các con vật",
    "Vẽ đồng hồ (Clock Drawing Test)"
  ),
  Diem_BT = c(
    "≥ 26/30", "≥ 12/30",
    "≤ 180 giây", "≤ 300 giây",
    "≥ 4/10", "≥ 6/10",
    "≥ 6/12", "≥ 4/12",
    "≥ 9", "Từ 1 đến 6"
  )
)

```

### Bảng các trắc nghiệm thần kinh nhận thức trong bộ VNCA

```{r}
#| echo: false
# Tạo flextable đẹp, có gộp dòng và fit khổ Word
flextable(bo_test_vnca) %>%
  set_caption("Bảng trắc nghiệm thần kinh nhận thức trong bộ VNCA") %>%
  merge_v(j = c("STT", "Linh_vuc")) %>%
  align(align = "center", part = "all") %>%
  valign(j = c("STT", "Linh_vuc"), valign = "top") %>%
  set_header_labels(
    STT = "STT",
    Linh_vuc = "Lĩnh vực",
    Trac_nghiem = "Trắc nghiệm",
    Diem_BT = "Điểm BT"
  ) %>%
  set_table_properties(width = 1, layout = "autofit")
```

### Mô tả các trắc nghiệm thần kinh nhận thức trong bộ VNCA

-   **Sàng lọc chứng sa sút trí tuệ** sử dụng *Mini-Mental State Examination (MMSE)* là một trong những test được dùng thường xuyên nhất trong tầm soát SSTT. Nó bao gồm các nội dung về định hướng, chú ý, trí nhớ, ngôn ngữ và kĩ năng thị giác không gian. Tổng điểm đạt được từ 0 đến 30, với điểm càng thấp cho thấy càng suy giảm chức năng nhận thức nặng nề.

-   **Nhớ từ** bao gồm danh sách 10 từ sẽ được lặp lại cho đối tượng 3 lần với tổng điểm là 30. Ba lần này nhằm khảo sát lần lượt là nhớ từ lại ngay, nhớ lại có trì hoãn, nhận biết có trì hoãn.

-   **Tập trung chú ý** bao gồm *Digit span* (Nói lập lại dãy số), nói lại xuôi dãy số, nhằm khảo sát sự chú ý và trí nhớ gần (điểm từ 0 đến 14) và nói lại ngược dãy số, nhằm khảo sát sự chú ý và trí nhớ làm việc (điểm từ 0 đến 12). Người khảo sát sẽ đọc dãy số (1 số/giây) và yêu cầu đối tượng tham gia nói lại.

-   **Vận động thị giác**: Bao gồm *Trail Making Tests A & B (TMT-A, TMT-B)* đánh giá sự tìm kiếm thị giác, dò tìm, tốc độ xử lý, sự linh hoạt thần kinh và chức năng điều hành.\
    **TMT-A** yêu cầu đối tượng vẽ đường thẳng nối 25 con số trong vòng tròn theo thứ tự trên giấy.\
    **TMT-B** có yêu cầu tương tự nhưng người làm phải thay đổi giữa chữ và số. Điểm được cho theo thời gian hoàn thành test, với giới hạn bình thường dưới 150 giây cho test TMT-A và 300 giây cho test TMT-B.

-   **Ngôn ngữ**: *Nói lưu loát từ về con vật* khảo sát sự lưu loát ngôn ngữ, cụ thể là đưa ra lời nói, trí nhớ ngữ nghĩa và ngôn ngữ. Đối tượng phải nói ra nhiều tên con vật khác nhau nhất có thể trong 60 giây. Điểm được cho theo mỗi con vật nêu ra, điểm càng cao cho thấy chức năng ngôn ngữ càng tốt.

-   **Thị giác không gian**: *Trắc nghiệm vẽ đồng hồ* được dùng để khảo sát khả năng xây dựng hình ảnh qua thị giác. Người làm được cung cấp một tờ giấy trắng và yêu cầu vẽ trên đó một đồng hồ, có đầy đủ các số giờ và vẽ kim đồng hồ chỉ 11 giờ 10 phút. Kết quả được đánh giá từ 1 đến 6 điểm theo thang **Shulman**.\
    Trắc nghiệm vẽ đồng hồ gián tiếp đánh giá sự chú ý phức tạp, chức năng điều hành, học tập và trí nhớ, chức năng ngôn ngữ, giác quan vận động và nhận thức xã hội — vốn là những lĩnh vực nhận thức giúp đánh giá tổng thể.

### Các nghiên cứu trong và ngoài nước

### Mối tương quan giữa MMSE và bài Nhớ từ (Words List Recall)

Bài **nhớ từ** (gồm nhớ lại ngay, trì hoãn và nhận biết có trì hoãn) phản ánh trí nhớ gần và trí nhớ dài hạn – các lĩnh vực bị ảnh hưởng sớm trong sa sút trí tuệ.

Tại Việt Nam, Nguyễn Thị Hạnh và cộng sự cho thấy MMSE có tương quan trung bình với **nhớ từ trì hoãn** (r = 0,59) và yếu hơn với **nhớ lại ngay** (r = 0,42) @nguyen2020mmse.\
Trần Hồng Quân và đồng nghiệp cũng ghi nhận rằng người có MMSE thấp thường chỉ nhớ được dưới 5 từ sau 10 phút trì hoãn, phản ánh suy giảm trí nhớ dài hạn rõ rệt @tran2021tri_nho. Nhiều nghiên cứu quốc tế cũng khẳng định mối liên hệ này: - Nghiên cứu của Ivnik và cộng sự (1990) ghi nhận MMSE tương quan cao với **delayed recall** (r ≈ 0,60) trong bộ AVLT @ivnik1990avlt. - Welsh et al. (1994) cho thấy bài **CERAD word list recall** có thể dự đoán tốt mức độ suy giảm MMSE ở bệnh nhân Alzheimer nhẹ (r ≈ 0,68) @welsh1994cerad. - Sarazin và cộng sự (2007) nhận thấy rằng giảm điểm word list recall là chỉ dấu sớm của Alzheimer và có mối tương quan mạnh với MMSE trong suốt quá trình tiến triển bệnh @sarazin2007amnestic.

Những kết quả này củng cố giá trị của bài **nhớ từ trì hoãn** như một chỉ báo nhận thức nhạy trong sàng lọc sa sút trí tuệ và cho thấy sự đồng thuận giữa MMSE với các bài kiểm tra trí nhớ chuyên sâu.

# ĐỐI TƯỢNG VÀ PHƯƠNG PHÁP NGHIÊN CỨU

## Dân số mục tiêu:

Bệnh nhân sa sút trí tuệ trong bối cảnh ngoại trú ở các khoa – phòng khám lâm sàng chuyên về trí nhớ và sa sút trí tuệ.

## Dân số chọn mẫu:

Bệnh nhân đến khám và điều trị tại phòng khám thuộc Đơn vị trí nhớ và sa sút trí tuệ, bệnh viện 30-4.

### Cỡ mẫu:

Cỡ mẫu tối thiểu cho nghiên cứu được xác định theo công thức ước lượng một tỷ lệ:

$$
  n = \frac{Z_{(1 - \alpha/2)}^2 \cdot p(1 - p)}{\varepsilon^2}
$$

Trong đó:

-   $n$: cỡ mẫu cần thiết
-   $\alpha$: mức ý nghĩa thống kê, chọn $\alpha = 0.05$
-   $Z_{(1 - \alpha/2)} = 1.96$: giá trị Z tương ứng với mức tin cậy 95%
-   $p$: tỷ lệ điều trị hiệu quả. Theo nghiên cứu của Schroeder RW, tỷ lệ trắc nghiệm thần kinh nhận thức phát hiện bệnh nhân sa sút trí tuệ là **75%**, nên chọn $p = 0.75$
-   $\varepsilon = 0.05$: sai số chấp nhận trong nghiên cứu

Thay vào công thức:

$$
  n = \frac{(1.96)^2 \cdot 0.75 \cdot (1 - 0.75)}{(0.05)^2} = \frac{3.8416 \cdot 0.1875}{0.0025} = \frac{0.7203}{0.0025} \approx 288.12
$$

**→ Cỡ mẫu cần thiết là ít nhất 288 bệnh nhân.**

### Kỹ thuật chọn mẫu:

Đối với hồi cứu: Phương pháp chọn mẫu được sử dụng là phương pháp chọn mẫu dựa vào danh sách bệnh nhân đang điều trị tại khoa, đối chiếu các tiêu chuẩn chọn vào và tiêu chuẩn loại trừ với hồ sơ bệnh án có sẵn. Sau đó, trong số những bệnh nhân hoàn toàn phù hợp với tiêu chuẩn chọn vào và không có bất kỳ tiêu chuẩn loại trừ nào sẽ được chọn.

Đối với tiến cứu, những bệnh nhân được chọn lựa sẽ được tiến hành xin đồng thuận tham gia nghiên cứu và thu thập số liệu vào ngày khám bệnh kế tiếp gần nhất.

## Các biến số nghiên cứu

```{r}
#| include: false
data <- data.frame(
  Ten_bien = c(
    "Tuổi", "Giới tính", "Tuổi khởi phát", "Thời gian phát hiện bệnh", 
    "Trình độ học vấn", "Nghề nghiệp trước đây", "Tình trạng hôn nhân", 
    "Tiền sử gia đình", "Bệnh đi kèm", "Thang MMSE", "Tiểu thang MMSE",
    "Word List", "Digit span forward", "Digit span backward",
    "TMT-A", "TMT-B", "Khảo sát sự lưu loát ngôn ngữ.",
    "Trắc nghiệm vẽ đồng hồ", "Chẩn đoán", "Giai đoạn"
  ),
  Loai_bien = c(
    "Định lượng", "Định tính", "Định tính", "Định lượng", 
    "Định tính", "Định tính", "Định tính", "Định tính", "Định tính", 
    "Định lượng", "Định lượng", "Định lượng", "Định lượng", "Định lượng", 
    "Định tính", "Định tính", "Định lượng", "Định lượng", "Định tính", "Định tính"
  ),
  Gia_tri_don_vi = c(
    "Năm", "Nam/Nữ", "Khởi phát sớm/khởi phát muộn", "Năm",
    "Cấp 1, cấp 2, cấp 3, cao đẳng/đại học, không xác định", 
    "Toàn thời gian, bán thời gian, về hưu", 
    "Có chồng vợ, góa, ly thân/ly hôn", "Có bị SSTT", "Có, không", 
    "Giá trị từ 0 - 30", "Tùy thuộc chức năng nhận thức", 
    "Giá trị từ 0 – 30", "Giá trị từ 0 – 14", "Giá trị từ 0 – 12", 
    "Thời gian đạt khi dưới 150 giây", "Thời gian đạt khi dưới 300 giây", 
    "Số lượng các con vật người làm trắc nghiệm kể tên", 
    "1 đến 6 điểm theo thang Shulman", "SCI, MCI và SSTT", 
    "Giai đoạn nhẹ, trung bình, nặng"
  )
)

```

```{r}
#| echo: false

ft <- data %>%
  flextable() %>%
  set_header_labels(
    Ten_bien = "Tên biến",
    Loai_bien = "Loại biến",
    Gia_tri_don_vi = "Giá trị / Đơn vị"
  ) %>%
  autofit() %>%
  set_table_properties(width = 1, layout = "autofit") %>%
  font(fontname = "Times New Roman", part = "all")  %>%
  fontsize(size = 13, part = "all")

ft

```

### Phương pháp tiến hành.

Bệnh nhân tới khám tại Đơn vị trí nhớ và sa sút trí tuệ Bệnh viện 30-4 được Bác sĩ thần kinh chỉ định làm trắc nghiệm thần kinh nhận thức bởi các nhân viên Y tế được huấn luyện theo quy trình thực hiện bộ test chuẩn. - Phương pháp hồi cứu. Tra cứu hồ sơ bệnh án tất cả những bệnh nhân được khám tại đơn vị từ 4/2019 tới thời điểm nghiên cứu. Đánh giá lại bộ test nếu bệnh nhân tái khám trong thời gian nghiên cứu. - Phương pháp tiến cứu. Bệnh nhân đến khám trong thời gian nghiên cứu được thăm khám, làm test, chẩn đoán và đánh giá mức độ sa sút trí tuệ tên lâm sàng. Nghiên cứu đánh giá Đánh giá mối tương quan giữa MSSE và các test khác trong bộ Test thần kinh nhận thức khác, tỷ lệ hoàn thành Test thần kinh nhận thức đối với suy giảm nhận thức nhẹ và Sa sút trí tuệ. Đánh giá mối tương quan phân độ sa sút trí tuệ ở thang điểm MMSE và phân độ sa sút trí tuệ trên lâm sàng.

## Phương pháp và công cụ đo lường, thu thập số liệu

-   Nhập liệu và quản lý dữ liệu bằng phần mềm SPSS 20, xử lý số liệu bằng phần mềm R 4.2.3 (Packages sử dụng trong nghiên cứu: table1, dplyr, ggplot2, boot, simpleboot, afex.)
-   Mô tả các biến định lượng: bằng trung bình, độ lệch chuẩn, giá trị nhỏ nhất, giá trị lớn nhất (phân bố chuẩn), hoặc trung vị và tứ phân vị (không phân phối chuẩn), sử dụng bootstrap 10.000 lượt để tính khoảng tin cậy 95%.
-   Mô tả các biến định tính: bằng tần số và tỷ lệ phần trăm.
-   So sánh giá trị trung bình ở các nhóm dùng kiểm định Independent Sample t-test..
-   So sánh sự khác biệt giữa các tỷ lệ với các biến định tính dùng kiểm định Chi bình phương (χ2), hoặc kiểm định Fisher's Exact.
-   Đánh giá mối liên quan các giữa biến định lượng: MMSE các trắc nghiệm khác, sử dụng hệ số tương quan Pearson (phân bố chuẩn), hoặc sử dụng hệ số tương quan Spearman (không phân phối chuẩn). Hệ số tương quan (r) được đánh giá như sau: • \|r\| ≥ 0, 7: Tương quan chặt • \|r\| = 0, 5- 0,7: Tương quan khá chặt • \|r\| ≥ 0, 3 – 0,5: Tương quan vừa • \|r\| \< 0,3: Tương quan yếu • \|r\| =0 Không tương quan
-   Đánh giá mức độ hoàn thành làm Test thần kinh nhận thức bằng tần số và tỷ lệ phần trăm.
-   Đánh giá mối liên quan các giữa phân loại bệnh theo MMSE và phân loại bệnh trên lâm sàng dùng kiểm định Chi bình phương (χ2), hoặc kiểm định Fisher's Exact. Đạo đức nghiên cứu
-   Nghiên cứu được thông qua hội đồng Đạo đức đối với nghiên cứu Y sinh.
-   Đây là nghiên cứu quan sát, không can thiệp vào quá trình điều trị bệnh nhân, các hoạt động chẩn đoán và điều trị hoàn toàn tuân theo phác đồ của Bệnh viện.
-   Mọi thông tin liên quan đến bệnh nhân sẽ được bảo mật. Tác giả nghiên cứu tuân thủ quy trình nghiên cứu

### Đạo đức trong nghiên cứu

# KẾT QUẢ NGHIÊN CỨU

Có **`r nrow(df)`** người được tuyển chọn vào mẫu nghiên cứu. Toàn bộ người tham gia nghiên cứu thỏa đầy đủ các tiêu chuẩn chọn mẫu và không có bất cứ tiêu chuẩn loại trừ nào. Đối với trường hợp hồi cứu, chúng tôi truy suất hồ sơ bệnh án. Đối với tiến cứu sau khi được cung cấp thông tin về nghiên cứu và có sự đồng thuận tham gia của người có quyền giám hộ bệnh nhân, người tham gia nghiên cứu chúng tôi ghi nhận thông tin trên hồ sơ bệnh án để tiến hành thu thập dữ liệu. Kết quả nghiên cứu trình bày như sau: [Đặc điểm mẫu của nghiên cứu,](#dac-diem-kq) [mối tương quan MMSE với các test thần kinh nhận thức khác,](#tuong-quan-kq) [đánh giá hiệu quả ứng dụng trong chẩn đoán và điều trị bộ test thần kinh nhận thức](#ung-dung-kq)

## Đặc điểm mẫu của nghiên cứu {#dac-diem-kq}

### Đặc điểm theo tuổi nhà nhóm tuôi

#### Đặc điểm theo tuổi

-   Bảng thống kê tuổi bệnh nhân.

```{r}
#| echo: false
ft_tuoi
```

##### `r inline_bang_tuoi_ketqua`

-   Biểu đồ theo tuổi

```{r}
#| echo: false
tuoi_gp
```

##### `r inline_bieudo_tuoi_ketqua`

#### Đặc điểm nhóm tuổi

-   Bảng nhóm tuổi

```{r tbl-nhom_tuoi_ketqua-flextable, echo=FALSE, results='asis'}
#| message: false
#| warning: false
#| paged-print: false
ft_freq_p
```

##### `r inline_bang_nhom_tuoi_ketqua`

-   Biểu đồ theo nhóm tuổi

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
nhom_tuoi_gp
```

##### `r inline_bieudo_nhom_tuoi_ketqua`

### Giới tính

-   Bảng theo giới tính

```{r tbl-gioi_tinh_ketqua-flextable, echo=FALSE, results='asis'}
ft_gender
```

##### `r inline_bang_gioitinh_ketqua`

-   Biểu đồ theo giới tính

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
gioitinh_bar_percent
```

##### `r inline_bang_gioitinh_ketqua`

### Trình độ học vấn

-   Bảng trình độ học vấn

```{r results='asis'}
#| echo: false
ft_edu
```

##### `r inline_table_hocvan`

-   Biểu đồ trình độ học vấn

```{r}
hocvan_bar_percent
```

##### `r inline_plot_hocvan`

### Đặc điểm MMSE

#### Bảng phân loại suy giảm nhận thức và sa sút trí tuệ theo MMSE

```{r}
#| echo: false
ft_mmse

```

##### `r inline_bang_mmse`

#### Biểu đồ phân loại mmse

```{r}
#| echo: false
ggplot_mmse

```

##### `r inline_bieudo_mmse`

#### Biểu đồ phân loại suy giảm nhận thức và sa sút trí tuệ theo MMSE

```{r}
#| label: Biểu đồ  phân loại suy giảm nhận thức và sa sút trí tuệ theo MMSE chen kết quả 
#| echo: false
ggplot_mmse
```

### Đặc điểm các test thần kinh nhận thức

#### Bảng đặc điểm các test thần kinh nhận thức

```{r}
#| echo: false
ft_nhanthuc_group
```

##### `r inline_bang_tests_group`

#### Biểu đồ đặc điểm các test thần kinh nhận thức

```{r}
#| echo: false
plot_nhanthuc_group
```

##### `r inline_bieudo_tests_group`

## Mối tương quan MMSE với các test thần kinh nhận thức khác {#tuong-quan-kq}

### Bảng mối tương quan MMSE với các test thần kinh nhận thức khác

```{r}
#| echo: false
ft_corr_long
```

##### **Nhóm MCI**: `r cau_bang_mci` , `r cau_bang_sstt`

### Biểu đồ mối tương quan MMSE với các test thần kinh nhận thức khác

```{r}
#| echo: false
plot_corr_grouped
```

##### `r cau_inline_so_sanh_sstt_mci`

## Đánh giá hiệu quả ứng dụng trong chẩn đoán và điều trị bộ test thần kinh nhận thức {#ung-dung-kq}

### Đánh giá mức độ hoàn thành bộ test thần kinh nhận thức

#### Bảng mức độ hoàn thành bộ test thần kinh nhận thức

```{r}
#| label: B mức độ hoàn thành bộ test thần kinh nhận thức
#| echo: false
ft_hoanthanh
```

##### `r cau_hoanthanh_bang`

```{r}
#| label: BD hoàn thành bộ test thần kinh nhận thức
#| echo: false
plot_hoanthanh
```

##### `r cau_hoanthanh_ggplot`

#### Biểu đồ mức độ hoàn thành bộ test thần kinh nhận thức

Đặc điểm hiệu quả ứng dụng

### Đánh giá sự tương đồng giữa phân độ MMSE và phân loại lâm sàng theo tiêu chuẩn lâm sàng

#### Biểu đồ heatmap

```{r}
#| label: Biểu đồ heatmap
#| message: false
#| warning: false
#| include: false
plot_heat
```

##### `r cau_chen_bieu_do_heatmap`

#### Biểu đồ tán xạ đánh giá sự tương đồng giữa phân độ MMSE và phân loại lâm sàng theo tiêu chuẩn lâm sàng

```{r}
#| label: Sự tương đồng giữa phân độ MMSE và phân loại lâm sàng theo tiêu chuẩn lâm sàng kết quả
#| echo: false
plot_scatter
```

##### `r cau_bieudo_ordinal`

# BÀN LUẬN

## Đặc điểm mẫu của nghiên cứu

### Đặc điểm theo Tuổi

::: {custom-style="chu_xanh"}
`r inline_tuoi_banluan`
:::

Kết quả nghiên cứu cho cho thấy tuổi là một yếu tố liên quan rõ rệt đến mức độ suy giảm chức năng nhận thức.

Phát hiện này phù hợp với nhiều nghiên cứu trước đây. Theo dữ liệu từ Tổ chức Y tế Thế giới (WHO), tuổi cao là yếu tố nguy cơ lớn nhất dẫn đến sa sút trí tuệ, với tỷ lệ hiện mắc tăng mạnh ở nhóm người trên 65 tuổi. Cụ thể, tỷ lệ sa sút trí tuệ tăng gấp đôi sau mỗi 5 năm tuổi sau mốc 65 tuổi @who2021dementia.

Tương tự, nghiên cứu của Prince và cộng sự (2015) thuộc báo cáo World Alzheimer Report cũng chỉ ra rằng nguy cơ mắc sa sút trí tuệ gia tăng theo tuổi, đặc biệt rõ ràng từ 60 tuổi trở lên. Điều này khẳng định rằng tuổi đóng vai trò trung tâm trong sinh bệnh học của sa sút trí tuệ @prince2015world.

Việc nhóm sa sút trí tuệ có độ tuổi trung bình cao hơn cũng phản ánh xu hướng bệnh lý tiến triển từ giai đoạn suy giảm nhận thức nhẹ sang giai đoạn nặng hơn. Đây là cơ sở quan trọng cho việc sàng lọc và can thiệp sớm ở người cao tuổi, từ đó có thể làm chậm quá trình tiến triển bệnh và giảm gánh nặng xã hội.

::: {custom-style="chu_xanh"}
`r inline_nhom_tuoi_banluan`
:::

Xu hướng này phản ánh mối liên quan chặt chẽ giữa tuổi cao và mức độ tiến triển của suy giảm nhận thức. Khi tuổi tăng, nguy cơ chuyển từ giai đoạn suy giảm nhận thức nhẹ sang sa sút trí tuệ cũng tăng theo. Petersen và cộng sự (2018) đã chỉ ra rằng mỗi năm có khoảng 10–15% bệnh nhân MCI chuyển sang giai đoạn sa sút trí tuệ, và tỷ lệ này gia tăng ở người lớn tuổi @petersen2018mci.

Ngoài ra, Tổ chức Y tế Thế giới (World Health Organization, 2021) nhấn mạnh rằng tỷ lệ sa sút trí tuệ tăng gấp đôi sau mỗi 5 năm tuổi sau mốc 65 tuổi. Điều này hoàn toàn phù hợp với kết quả nghiên cứu này, khi tỷ lệ sa sút trí tuệ tăng từ 67,8% ở nhóm 50–59 tuổi lên đến 100% ở nhóm ≥80 tuổi @who2021dementia.

Phát hiện này cho thấy tầm quan trọng của việc sàng lọc nhận thức ở những nhóm tuổi sớm hơn (từ 50 tuổi trở đi), nhằm phát hiện các biểu hiện ban đầu của rối loạn nhận thức và can thiệp kịp thời để làm chậm quá trình tiến triển. Đồng thời, việc tập trung chăm sóc và quản lý bệnh lý sa sút trí tuệ ở người cao tuổi, đặc biệt từ 70 tuổi trở lên, là vô cùng cấp thiết trong bối cảnh dân số già hóa nhanh chóng.

### Đặc điểm theo giới tính

::: {custom-style="chu_xanh"}
`r inline_bang_gioitinh_banluan`
:::

Kết quả nghiên cứu cho thấy tỷ lệ nữ giới chiếm ưu thế ở cả hai nhóm rối loạn nhận thức. Trong nhóm suy giảm nhận thức nhẹ, nữ giới chiếm 69,4%, trong khi nam giới chỉ chiếm 30,6%. Ở nhóm sa sút trí tuệ, nữ giới chiếm 60,1%, nam là 39,9%. \## Bàn luận về tuổi tác

Tuổi tác là một yếu tố nguy cơ không thể thay đổi trong sa sút trí tuệ. Trong nghiên cứu hiện tại, tuổi trung bình của nhóm sa sút trí tuệ cao hơn rõ rệt so với nhóm suy giảm nhận thức nhẹ. Điều này hoàn toàn phù hợp với bằng chứng dịch tễ học trên toàn cầu, khi tỷ lệ sa sút trí tuệ tăng dần theo tuổi, đặc biệt sau 65 tuổi [@livingston2020lancet].

Theo WHO, cứ mỗi 5 năm sau tuổi 65 thì nguy cơ mắc sa sút trí tuệ tăng gần gấp đôi [@who2021dementia]. Một nghiên cứu tại Việt Nam của Lê Văn Tuấn và cộng sự (2019) cũng xác nhận người ≥75 tuổi có nguy cơ cao hơn đáng kể so với nhóm 60–74 tuổi [@le2019travinhsstt].

Những phát hiện này nhấn mạnh vai trò của các chương trình can thiệp sớm, tầm soát định kỳ, và giáo dục cộng đồng tập trung vào lứa tuổi trung niên để giảm thiểu gánh nặng bệnh lý ở giai đoạn cao tuổi.

Xu hướng này phù hợp với nhiều nghiên cứu quốc tế và trong nước, cho thấy nữ giới là nhóm có nguy cơ cao hơn mắc các rối loạn nhận thức. Theo Tổ chức Y tế Thế giới, phụ nữ sống thọ hơn nam giới, dẫn đến tỷ lệ mắc sa sút trí tuệ cao hơn ở nữ [@who2021dementia]. Báo cáo toàn cầu về sa sút trí tuệ năm 2015 cũng nhấn mạnh rằng phụ nữ chiếm phần lớn dân số mắc bệnh, đặc biệt ở nhóm tuổi ≥75 [@prince2015world].

Nghiên cứu của Petersen và cộng sự (2018) tại Hoa Kỳ cũng ghi nhận phụ nữ không chỉ có nguy cơ cao hơn mắc bệnh mà còn có tốc độ tiến triển nhanh hơn ở một số thể bệnh như Alzheimer [@petersen2018mci].

Tại Việt Nam, nhiều khảo sát cộng đồng đã ghi nhận xu hướng tương tự. Ví dụ, nghiên cứu của Nguyễn Thị Nhung và cộng sự (2014) thực hiện tại Hà Nội trên 300 người cao tuổi cho thấy tỷ lệ sa sút trí tuệ ở nữ giới (28,7%) cao hơn đáng kể so với nam giới (17,9%) [@nhung2014]. Một nghiên cứu khác tại TP. Hồ Chí Minh do Trần Văn Hảo và cộng sự (2020) cũng cho thấy tỷ lệ nữ mắc rối loạn nhận thức giai đoạn sớm là 62,3%, cao hơn nam giới (37,7%) [@hao2020].

Những khác biệt này có thể lý giải bởi các yếu tố sinh học (suy giảm estrogen sau mãn kinh), tuổi thọ cao hơn, và đặc biệt là yếu tố xã hội: nữ giới lớn tuổi ở Việt Nam thường có trình độ học vấn thấp hơn, ít tham gia vào các hoạt động trí tuệ và xã hội, đồng thời chịu ảnh hưởng từ vai trò truyền thống trong gia đình. Đây đều là những yếu tố làm tăng nguy cơ suy giảm nhận thức.

Từ đó có thể thấy rằng giới tính là một yếu tố quan trọng trong việc đánh giá nguy cơ sa sút trí tuệ và cần được xem xét khi xây dựng chiến lược phòng ngừa. Các chương trình tầm soát và can thiệp cần thiết kế phù hợp với đặc điểm của nữ giới trung niên và cao tuổi, nhằm nâng cao nhận thức, cải thiện chất lượng sống và giảm gánh nặng bệnh tật cho cộng đồng.

### Đặc điểm trình độ học vấn

::: {custom-style="chu_xanh"}
`r inline_banluan_hocvan`
:::

Trình độ học vấn là một trong những yếu tố quan trọng ảnh hưởng đến nguy cơ mắc suy giảm nhận thức và sa sút trí tuệ. Trong nghiên cứu này, nhóm suy giảm nhận thức nhẹ (MCI) có tỷ lệ trình độ đại học cao hơn rõ rệt (38,8%) so với nhóm sa sút trí tuệ (25,1%). Trong khi đó, nhóm sa sút trí tuệ có tỷ lệ người học tiểu học cao hơn đáng kể (15,5% so với 4,7% ở nhóm MCI). Sự khác biệt này có ý nghĩa thống kê (*p* = 0,004), cho thấy học vấn có thể đóng vai trò bảo vệ quan trọng đối với chức năng nhận thức.

Các nghiên cứu quốc tế cũng khẳng định điều này. Báo cáo của Ủy ban Lancet (2020) cho biết việc không học hết trung học là một trong những yếu tố nguy cơ lớn nhất dẫn đến sa sút trí tuệ [@livingston2020lancet]. Tổ chức Y tế Thế giới (WHO) cũng xếp trình độ học vấn thấp vào nhóm các yếu tố nguy cơ có thể phòng ngừa được [@who2021dementia].

Một trong những giả thuyết được chấp nhận rộng rãi là lý thuyết "dự trữ nhận thức" (*cognitive reserve*), cho rằng học vấn cao giúp não bộ tạo ra mạng lưới thần kinh linh hoạt hơn và khả năng bù trừ tốt hơn khi có tổn thương do lão hóa hay bệnh lý [@stern2012cognitive].

Tại Việt Nam, nhiều nghiên cứu cũng cho kết quả tương tự. Lê Văn Tuấn và cộng sự (2019) khảo sát tại Trà Vinh cho thấy người mù chữ có nguy cơ sa sút trí tuệ cao gấp hơn 3 lần so với người biết chữ (OR = 3,3; KTC 95%: 1,4–7,9) [@le2019travinhsstt]. Tương tự, Trần Văn Hào (2020) tại Vĩnh Long ghi nhận tỷ lệ sa sút trí tuệ ở nhóm học vấn thấp cao hơn nhóm học vấn cao có ý nghĩa thống kê [@tran2020vinhlonghocvan].

Những bằng chứng này nhấn mạnh tầm quan trọng của giáo dục trong giai đoạn đầu đời như một biện pháp can thiệp lâu dài nhằm phòng ngừa sa sút trí tuệ ở người cao tuổi.

### Đặc điểm thang điểm MMSE

`r inline_mmse_banluan`. Tỷ lệ cao nhất thuộc về nhóm sa sút trí tuệ trung bình phản ánh tình trạng nhiều bệnh nhân chỉ được phát hiện khi bệnh đã tiến triển ở mức độ đáng kể. Đây là thực trạng phổ biến trong lâm sàng Việt Nam, được đề cập trong nghiên cứu của **TS Trần Công Thắng và cộng sự (2016)** khi khảo sát trên 500 người ≥60 tuổi tại bệnh viện lão khoa trung ương – ghi nhận tỷ lệ sa sút trí tuệ trung bình và nặng chiếm trên 50%, trong khi tỷ lệ phát hiện MCI còn thấp [@tran2016mmse].

Theo hướng dẫn quốc tế, phát hiện sớm ở giai đoạn MCI là mục tiêu quan trọng vì đây là giai đoạn có thể can thiệp hiệu quả nhằm làm chậm tiến triển hoặc thậm chí phục hồi chức năng nhận thức [@petersen2018mci]. Tuy nhiên, trong nghiên cứu này, `r inline_mci_mota_phantram_banluan` Điều này phản ánh một lỗ hổng trong việc tầm soát định kỳ và nâng cao nhận thức cộng đồng.

Báo cáo của **Ủy ban Lancet (2020)** cũng nhấn mạnh rằng việc phát hiện sớm, đặc biệt ở các nước thu nhập trung bình như Việt Nam, là chìa khóa để giảm thiểu gánh nặng kinh tế và xã hội của sa sút trí tuệ [@livingston2020lancet].

Trong nghiên cứu chúng tôi thấy rằng *`r ti_le_sstt_nang_theo_mmse`* điều này cũng đáng chú ý, cho thấy vẫn còn một tỷ lệ không nhỏ người bệnh đến khám khi đã suy giảm chức năng rõ rệt, kèm theo gánh nặng chăm sóc lớn cho gia đình và xã hội.

Tổng thể, phân bố phân độ MMSE trong nghiên cứu phản ánh thực trạng lâm sàng tại Việt Nam: chẩn đoán muộn, phát hiện MCI còn hạn chế. Việc tăng cường truyền thông, đào tạo nhân viên y tế cơ sở và tích hợp tầm soát trí nhớ vào khám sức khỏe định kỳ sẽ là hướng đi cần thiết trong chiến lược quốc gia về sa sút trí tuệ.

### Đặc điểm các test thần kinh nhận thức

::: {custom-style="chu_xanh"}
inline_banluan_tests
:::

Bàn luận: Khả năng ghi nhớ và nhận biết trong sa sút trí tuệ Trong nghiên cứu này, chúng tôi quan sát thấy sự suy giảm rõ rệt ở cả ba chức năng ghi nhớ tức thì ("Nhớ lại ngay"), ghi nhớ sau thời gian trì hoãn ("Nhớ lại có trì hoãn") và nhận biết trì hoãn ("Nhận biết có trì hoãn") khi mức độ sa sút trí tuệ tiến triển từ nhẹ đến trung bình và nặng.

Trung bình điểm "Nhớ lại ngay" là `r round(mean(df$nholai_ngay, na.rm=TRUE), 1)`, khi phân tích theo nhóm MMSE, nhóm Suy giảm nhận thức nhẹ đạt trung bình `r round(mean(df$nholai_ngay[df$mmse_group == 'Suy giảm nhận thức nhẹ'], na.rm=TRUE), 1)`, trong khi nhóm Sa sút trí tuệ trung bình chỉ còn `r round(mean(df$nholai_ngay[df$mmse_group == 'Sa sút trí tuệ trung bình'], na.rm=TRUE), 1)` Điều này cho thấy sự tổn thương tiến triển của trí nhớ ngắn hạn – vốn phụ thuộc vào hoạt động của thùy thái dương giữa và hồi hải mã.

Những kết quả này khẳng định tầm quan trọng của việc đánh giá trí nhớ ngắn hạn và trung hạn trong chẩn đoán sớm và phân biệt các mức độ sa sút trí tuệ, từ đó hỗ trợ xây dựng kế hoạch can thiệp phù hợp.

### Điểm hạn chế

### Tính mới

### tính ứng dụng của đề tài

::: {custom-style="CAN GIUA DAM 14 ONE"}
KẾT LUẬN
:::

Mục tiêu 1 Mục tiêu 2

## Tạo slide báo cáo

### Tạo slide báo cáo

```{r}
my_pres  <- read_pptx("sstt_SLIDE_input.pptx") 

myftr <- "Bệnh viện 30-4"
```

### Slide tiêu đề

### Slide vai trò test thần kinh nhận thức

```{r}
#| label: slide vai tro test than kinh nhan thuc
# add slide
my_pres  <- add_slide(my_pres , layout = "Title and Content", master = "Office Theme")
# add title of slide
my_pres <- ph_with(my_pres, value = "Vai trò test thần kinh nhận thức", location = ph_location_type(type = "title"))
# add body of slide
my_pres <- ph_with(my_pres, value = c("Việc phân tích tốt các thang điểm tâm thần kinh này hỗ trợ các bác sĩ lâm sàng trong việc chẩn đoán, chẩn đoán phân biệt thể bệnh" ,  "xác định lĩnh vực nhận thức bị khiếm khuyết, mức độ nặng","Chọn lựa các phương pháp can thiệp nhận thức không dùng thuốc như tập luyện nhận thức (cognitive training), phục hồi nhận thức (cognitive rehabilitation), kích thích nhận thức (cognitive stimulation); theo dõi diễn tiến khiếm khuyết nhận thức đặc biệt trong các trường hợp than phiền giảm nhận thức chủ quan (subjective cognitive impairment), suy giảm nhận thức nhẹ (mild cognitive impairment)."), location = ph_location_type(type = "body"))
```

### Slide nội dung chính

## Slide nội dung báo cáo

```{r}
#| include: false
ul <- unordered_list(
  level_list = c(1, 1, 1,1 ),
  str_list = c("Đặt vấn đề", "Đối tượng và phương pháp nghiên cứu", "Kết quả - Bàn luận", "Kết luận"),
  style = fp_text(color = "black", font.size = 0) )


my_pres  <- add_slide(my_pres , layout = "Title and Content", master = "Office Theme")

my_pres <- ph_with(my_pres, value = "Nội dung trình bày", location = ph_location_type(type = "title"))
my_pres <- ph_with(x = my_pres, value = ul, 
               location = ph_location_type(type = "body") )


```

### Slide mục tiêu nghiên cứu.

```{r}
#| include: false
ul <- unordered_list(
  level_list = c(1, 2,  1, 2, 2),
  str_list = c("Câu hỏi nghiên cứu", "Giá trí chẩn đoán và điều trị bộ test là gì?", "Mục tiêu", "Nghiên cứu mối tương quan của thang điểm MMSE với các test thần kinh nhận thức khác trong bộ Test thần kinh nhận thức tại Bệnh viện 30-4.", "Đánh giá hiệu quả ứng dụng của bộ Test thần kinh nhận thức trong chẩn đoán và điều trị Sa sút trí tuệ tại Bệnh viện 30-4"),
  style = fp_text(color = "black", font.size = 0) )


my_pres  <- add_slide(my_pres , layout = "Title and Content", master = "Office Theme")

my_pres <- ph_with(my_pres, value = "Câu hỏi NC, mục tiêu", location = ph_location_type(type = "title"))
my_pres <- ph_with(x = my_pres, value = ul, 
               location = ph_location_type(type = "body") )


```

### Slide đặt vấn đê

```{r}
#| label: slide dat van de
#| include: false
# add slide
my_pres  <- add_slide(my_pres , layout = "Title and Content", master = "Office Theme")
# add title of slide
my_pres <- ph_with(my_pres, value = "Đặt vấn đề", location = ph_location_type(type = "title"))
# add body of slide
my_pres <- ph_with(my_pres, value = c("SSTT là một bệnh lý của não bộ, gây ra suy giảm chức năng nhận thức, hành vi và hoạt động sống của bệnh nhân.",
  "Từ năm 2019 đến nay, Đơn vị Trí nhớ và Sa sút trí tuệ Bệnh viện 30-4 đã sử dụng bộ trắc nghiệm  đánh giá chức năng thần kinh nhận thức Việt Nam (VnCA)",
  "Phát hiện, đánh giá đúng mức những thay đổi sớm nhất về hành vi và nhận thức của bệnh nhân giúp các nhà lâm sàng chẩn đoán sớm, tối ưu hóa chiến lược điều trị, góp phần giảm thiểu gánh nặng bệnh tật do SSTT gây ra"), location = ph_location_type(type = "body"))


```

### Slide đối tượng và phương pháp nghiên cứu

```{r}
#| label: slide doi tuong va phuong phap nghien cuu
#| echo: true
ul <- unordered_list(
  level_list = c(1, 2,  1, 2, 2,2, 1, 2, 2, 2),
  str_list = c("Thiết kế ngiên cứu", "Mô tả cắt ngang", "Tiêu chuẩn chọn", "Bệnh nhân đến khám tại Đơn vị trí nhớ và SSTT ", "Từ 40 tuổi trở lên", "Có than phiền về trí nhớ hoặc nhận thức","Tiêu chuẩn loại trừ", "Không hợp tác", "Bệnh nhân đang bị mê sảng, lú lẫn cấp", "Suy giảm nhận thức không do nguyên nhân tâm thần kinh khác" ),
  style = fp_text(color = "black", font.size = 0) )


my_pres  <- add_slide(my_pres , layout = "Title and Content", master = "Office Theme")

my_pres <- ph_with(my_pres, value = "Đối tượng và phương pháp nghiên cúu", location = ph_location_type(type = "title"))
my_pres <- ph_with(x = my_pres, value = ul, 
               location = ph_location_type(type = "body") )


```

### Slide về đặc điểm tuổi 🌹

```{r}
#| label: slide tuoi flex ggplo 2
#| echo: true

my_pres <- add_slide(my_pres, layout = "Two Content", master = "Office Theme") #them slides
my_pres <- ph_with(my_pres, value = "Đặc điểm  tuổi  (Bảng và biểu đồ) ", location = ph_location_type(type = "title")) #them title


# Create and format the flextable
ft_tuoi <- ft_tuoi  %>%
  fontsize(size = 18, part = "header") %>% bold(bold = TRUE, part = "header") %>% bg( bg = "#D3D3D3", part = "header") %>%
  fontsize(size = 18, part = "body") %>%   autofit()

ft_tuoi <- width(ft_tuoi, width = 3, unit = "cm")

# Dat bieu do ben phai
my_pres <- ph_with( my_pres,  value = tuoi_gp
,   location = ph_location_label(ph_label = "Content Placeholder 3"))


# Dat bang ben T

my_pres <- ph_with( my_pres,  value = ft_tuoi,   location = ph_location_label(ph_label = "Content Placeholder 2"))

# chen inline
# Định dạng văn bản với fontsize = 16
inline_text <- ftext(inline_bieudo_tuoi_ketqua, 
                     prop = fp_text(font.size = 16))

# Gói trong fpar() để tạo paragraph
inline_paragraph <- fpar(inline_text)

# Chèn vào PowerPoint (ví dụ placeholder label là "Footer Placeholder 5")
my_pres <- ph_with(
  my_pres,
  value = inline_paragraph,
  location = ph_location_label(ph_label = "Footer Placeholder 5")
)
```

### Slide về đặc điểm giới 🌹

```{r}
#| label: slide tuoi footnote
#| echo: true

my_pres <- add_slide(my_pres, layout = "Two Content", master = "Office Theme") #them slides
my_pres <- ph_with(my_pres, value = "Đặc điểm  giới tính ", location = ph_location_type(type = "title")) #them title


# Create and format the flextable
ft_gender <- ft_gender  %>%
  fontsize(size = 18, part = "header") %>% bold(bold = TRUE, part = "header") %>% bg( bg = "#D3D3D3", part = "header") %>%
  fontsize(size = 18, part = "body") %>%   autofit()

ft_gender <- width(ft_gender, width = 3, unit = "cm")

# Dat bieu do ben phai
my_pres <- ph_with( my_pres,  value = gioitinh_bar_percent
,   location = ph_location_label(ph_label = "Content Placeholder 3"))


# Dat bang ben T

my_pres <- ph_with( my_pres,  value = ft_gender,   location = ph_location_label(ph_label = "Content Placeholder 2"))

# chen inline
# Định dạng văn bản với fontsize = 16
inline_text <- ftext(inline_bieudo_gioitinh_ketqua , 
                     prop = fp_text(font.size = 16))

# Gói trong fpar() để tạo paragraph
inline_paragraph <- fpar(inline_text)

# Chèn vào PowerPoint (ví dụ placeholder label là "Footer Placeholder 5")
my_pres <- ph_with(
  my_pres,
  value = inline_paragraph,
  location = ph_location_label(ph_label = "Footer Placeholder 5")
)
```

### xuat sang powerpoint

```{r}
print(my_pres , "sstt_SLIDE_output.pptx")
```

::: {custom-style="CAN GIUA DAM 14 ONE"}
TÀI LIỆU THAM KHẢO
:::
