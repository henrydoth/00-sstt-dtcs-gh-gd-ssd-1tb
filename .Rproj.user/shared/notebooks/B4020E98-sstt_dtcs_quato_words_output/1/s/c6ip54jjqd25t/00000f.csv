"0","#| label: Tóm tắt dữ liệu học vấn theo nhóm nhận thức"
"0","#| echo: true"
"0",""
"0","hocvan_summary <- df %>%"
"0","  count(phan_loan_roi_loan_nhan_thuc, edu) %>%"
"0","  group_by(phan_loan_roi_loan_nhan_thuc) %>%"
"0","  mutate(percent = n / sum(n) * 100) %>%"
"0","  ungroup()"
"0",""
"0","# Bảng flextable: Tần số (%) + p-value"
"0","table_edu <- hocvan_summary %>%"
"0","  mutate(`Tần số (%)` = sprintf(""%d (%.1f%%)"", n, percent)) %>%"
"0","  select(`Chẩn đoán` = phan_loan_roi_loan_nhan_thuc, `Trình độ học vấn` = edu, `Tần số (%)`) %>%"
"0","  pivot_wider("
"0","    names_from = `Trình độ học vấn`,"
"0","    values_from = `Tần số (%)`,"
"0","    values_fill = ""-"""
"0","  )"
"0",""
"0","# Tính p-value (Chi-squared hoặc Fisher)"
"0","chisq_edu <- table(df$phan_loan_roi_loan_nhan_thuc, df$edu)"
"0","use_fisher <- any(chisq_edu < 5)"
"0","p_val_edu <- if (use_fisher) fisher.test(chisq_edu)$p.value else chisq.test(chisq_edu)$p.value"
"0","formatted_p_edu <- ifelse(p_val_edu < 0.001, ""< 0.001"", sprintf(""%.3f"", p_val_edu))"
"0",""
"0","# Thêm dòng p-value"
"0","table_edu$`Giá trị p` <- c(formatted_p_edu, rep("""", nrow(table_edu) - 1))"
"0",""
"0","# Tạo bảng flextable"
"0","ft_edu <- flextable(table_edu) %>%"
"0","  autofit() %>%"
"0","  align(align = ""center"", part = ""all"") %>%"
"0","  bold(i = 1, part = ""header"") %>%"
"0","  bold(i = which("
"0","    table_edu$`Giá trị p` != """" &"
"0","    table_edu$`Giá trị p` != ""-"" &"
"0","    as.numeric(gsub(""< "", """", table_edu$`Giá trị p`)) < 0.05"
"0","  ),"
"0","  j = ""Giá trị p"", part = ""body"") %>%"
"0","  set_caption(""Bảng: Phân bố trình độ học vấn theo nhóm nhận thức (tô đậm nếu p < 0.05)"") %>%"
"0","  font(fontname = ""Times New Roman"", part = ""all"") %>%"
"0","  fontsize(size = 11, part = ""all"") %>%"
"0","  set_table_properties(width = 1, layout = ""autofit"")"
"0",""
"0",""
