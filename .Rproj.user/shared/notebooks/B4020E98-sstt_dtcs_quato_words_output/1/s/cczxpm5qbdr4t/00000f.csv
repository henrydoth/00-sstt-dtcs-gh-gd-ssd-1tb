"0","# Bước 1: Đảm bảo đúng thứ tự nhóm tuổi"
"0","df$nhom_tuoi <- factor(df$nhom_tuoi, levels = c(""40–49"", ""50–59"", ""60–69"", ""70–79"", ""80+""))"
"0",""
"0","# Bước 2: Tạo bảng tần số và phần trăm theo chẩn đoán và nhóm tuổi"
"0","table_freq <- df %>%"
"0","  count(phan_loan_roi_loan_nhan_thuc, nhom_tuoi) %>%"
"0","  group_by(phan_loan_roi_loan_nhan_thuc) %>%"
"0","  mutate(percent = n / sum(n) * 100) %>%"
"0","  ungroup() %>%"
"0","  mutate(`Tần số (%)` = sprintf(""%d (%.1f%%)"", n, percent)) %>%"
"0","  select(`Chẩn đoán` = phan_loan_roi_loan_nhan_thuc, `Nhóm tuổi` = nhom_tuoi, `Tần số (%)`) %>%"
"0","  pivot_wider("
"0","    names_from = `Nhóm tuổi`,"
"0","    values_from = `Tần số (%)`,"
"0","    values_fill = ""-"""
"0","  )"
"0",""
"0","# Bước 3: Tính p-value từ bảng tần số"
"0","chisq_data <- table(df$phan_loan_roi_loan_nhan_thuc, df$nhom_tuoi)"
"0","p_val <- chisq.test(chisq_data)$p.value"
"2","Warning: Chi-squared approximation may be incorrect"
"0","formatted_p <- ifelse(p_val < 0.001, ""< 0.001"", sprintf(""%.3f"", p_val))"
"0",""
"0","# Thêm cột ""Giá trị p"" vào dòng đầu tiên"
"0","table_freq$`Giá trị p` <- c(formatted_p, rep("""", nrow(table_freq) - 1))"
"0",""
"0","# Bước 4: Tạo bảng flextable và tô đậm nếu p < 0.05"
"0","ft_freq_p <- flextable(table_freq) %>%"
"0","  autofit() %>%"
"0","  align(align = ""center"", part = ""all"") %>%"
"0","  bold(i = 1, part = ""header"") %>%"
"0","  bold(i = which("
"0","    table_freq$`Giá trị p` != """" &"
"0","    table_freq$`Giá trị p` != ""-"" &"
"0","    as.numeric(gsub(""< "", """", table_freq$`Giá trị p`)) < 0.05"
"0","  ),"
"0","  j = ""Giá trị p"", part = ""body"") %>%"
"0","  set_caption(""Bảng: Tần số và tỷ lệ phần trăm nhóm tuổi theo chẩn đoán (tô đậm nếu p < 0.05)"")"
