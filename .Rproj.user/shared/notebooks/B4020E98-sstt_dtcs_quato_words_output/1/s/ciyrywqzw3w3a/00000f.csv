"0","# 1. Tóm tắt tỷ lệ nữ theo nhóm nhận thức"
"0","gender_summary <- df %>%"
"0","  count(phan_loan_roi_loan_nhan_thuc, gender) %>%"
"0","  group_by(phan_loan_roi_loan_nhan_thuc) %>%"
"0","  mutate(percent = n / sum(n) * 100) %>%"
"0","  ungroup() %>%"
"0","  filter(gender == ""Nữ"")  # chỉ lấy tỷ lệ nữ"
"0",""
"0","# 2. Hàm an toàn lấy phần trăm nữ cho từng nhóm"
"0","lay_phan_tram_nu <- function(nhom) {"
"0","  ket_qua <- gender_summary %>%"
"0","    filter(phan_loan_roi_loan_nhan_thuc == nhom) %>%"
"0","    pull(percent)"
"0","  if (length(ket_qua) == 0) return(0) else return(round(ket_qua, 1))"
"0","}"
"0",""
"0","# 3. Lấy phần trăm nữ theo nhóm"
"0","nu_mci  <- lay_phan_tram_nu(""MCI"")"
"0","nu_sstt <- lay_phan_tram_nu(""Sa sút trí tuệ"")"
"0",""
"0","# 4. Tính p-value từ kiểm định giới tính ~ nhóm nhận thức"
"0","p_gender <- chisq.test(table(df$phan_loan_roi_loan_nhan_thuc, df$gender))$p.value"
"0",""
"0","# 5. Diễn giải theo p-value"
"0","dien_giai_gt <- ifelse("
"0","  p_gender > 0.05,"
"0","  glue(""Sự khác biệt không có ý nghĩa thống kê với p = {sprintf('%.3f', p_gender)}.""),"
"0","  glue(""Sự khác biệt có ý nghĩa thống kê với p = {sprintf('%.3f', p_gender)}."")"
"0",")"
"0",""
"0","# 6. Câu mô tả cuối cùng (để dùng inline)"
"0","cau_gioitinh_mota <- glue::glue("
"0","  ""Trong nghiên cứu này, ở nhóm Suy giảm nhận thức nhẹ, nữ giới chiếm {nu_mci}%. "","
"0","  ""Ở nhóm Sa sút trí tuệ, nữ giới chiếm {nu_sstt}%. "","
"0","  ""{dien_giai_gt}"""
"0",")"
"0",""
